<!DOCTYPE html>
<html lang="en"
      data-content_root="../../"
      x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }"
      x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))"
      class="scroll-smooth"
      :class="{'dark': darkMode === 'dark' || (darkMode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)}"
>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="white" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="black" />
  
    <title>reemission.presenter | ReEmission 1.0.0 documentation</title>
    <meta property="og:title" content="reemission.presenter | ReEmission 1.0.0 documentation" />
    <meta name="twitter:title" content="reemission.presenter | ReEmission 1.0.0 documentation" />
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=1949e874" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme.css?v=42baaae4" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
        <link rel="search" title="Search" href="../../search.html" />
        <link rel="index" title="Index" href="../../genindex.html" />

    <script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
  <body x-data="{ showSidebar: false, showScrollTop: false }" class="min-h-screen font-sans antialiased bg-background text-foreground" :class="{ 'overflow-hidden': showSidebar }">
    <div x-cloak x-show="showSidebar" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" @click.self="showSidebar = false"></div><div id="page" class="relative flex flex-col min-h-screen"><a href="#content" class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100">
      Skip to content
    </a><header
  class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
    <div class="hidden mr-4 md:flex">
      <a href="../../index.html" class="flex items-center mr-6"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">ReEmission 1.0.0 documentation</span>
      </a></div><button
      class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden"
      type="button" @click="showSidebar = true">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" aria-hidden="true"
        fill="currentColor">
        <path
          d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z" />
      </svg>
      <span class="sr-only">Toggle navigation menu</span>
    </button>
    <div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
      <div class="flex-1 w-full md:w-auto md:flex-none"><form id="searchbox"
      action="../../search.html"
      method="get"
      class="relative flex items-center group"
      @keydown.k.window.meta="$refs.search.focus()">
  <input x-ref="search"
          name="q"
          id="search-input"
          type="search"
          aria-label="Search the docs"
          placeholder="Search ..."
          class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" />
  <kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
    <span class="text-xs">⌘</span>
    K
  </kbd>
</form>
      </div>
      <nav class="flex items-center space-x-1">
        <button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'"
          class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9"
          type="button"
          aria-label="Color theme switcher">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
            class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0">
            <path
              d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
            class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100">
            <path
              d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z" />
          </svg>
        </button>
      </nav>
    </div>
  </div>
</header>

    <div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside id="left-sidebar"
  class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky"
  :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }">

    <a href="../../index.html" class="!justify-start text-sm md:!hidden bg-background"><span class="font-bold text-clip whitespace-nowrap">ReEmission 1.0.0 documentation</span>
    </a>

    <div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
      <div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">About the Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory.html">Theoretical Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation/install_package.html">Installing RE-Emission</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation/using_docker.html">About Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation/building_image.html">Building the ReEmission Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation/using_image.html">Using the ReEmission Docker Image</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../running_docker.html">Running the ReEmission Docker Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demo.html">Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../json.html">JSON file format description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reporting.html">Reporting Calculation Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../geocaret_integration.html">Integration with GeoCARET</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/reemission.html">Python API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.model.html">Model (Main)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.input.html">Input Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.reservoir.html">Reservoir Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.catchment.html">Catchment Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.ns_catchment.html">Post-impoundment catchment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.emissions.html">Emissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.temperature.html">MonthlyTemperature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.biogenic.html">Biogenic Factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.profile.html">Emission Profile Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.presenter.html">Presenter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.utils.html">Utility functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.auxiliary.html">Auxiliary functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.constants.html">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.mixins.html">Mixins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.document_compiler.html">Document <span class="math notranslate nohighlight">\(\LaTeX\)</span> Compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.exceptions.html">Custom Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.app_logger.html">App Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.download.html">External Data Downloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.globals.html">Global variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/reemission.main.html">Main</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

</nav>
      </div>
    </div>
    <button type="button" @click="showSidebar = false"
      class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
        stroke="none" class="h-4 w-4">
        <path
          d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z" />
      </svg>
    </button>
  </aside>
        <main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs"
     class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
  <a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground"
     href="../../index.html">
    <span class="hidden md:inline">ReEmission 1.0.0 documentation</span>
    <svg xmlns="http://www.w3.org/2000/svg"
         height="18"
         width="18"
         viewBox="0 96 960 960"
         aria-label="Home"
         fill="currentColor"
         stroke="none"
         class="md:hidden">
      <path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z" />
    </svg>
  </a>
  
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap"
       href="../index.html">Module code</a>
    
<div class="mr-1">/</div><span aria-current="page"
        class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">reemission.presenter</span>
</nav>

    <div id="content" role="main">
      <h1>Source code for reemission.presenter</h1><div class="highlight"><pre>
<span></span><code><span id="line-1"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-2"><span class="sd">Presenter Module</span>
</span><span id="line-3">
</span><span id="line-4"><span class="sd">This module provides functionality for presenting Greenhouse Gas (GHG) emissions </span>
</span><span id="line-5"><span class="sd">computation results in various output formats such as Excel, JSON, LaTeX, and HTML.</span>
</span><span id="line-6">
</span><span id="line-7"><span class="sd">Classes:</span>
</span><span id="line-8"><span class="sd">    ExcelWriter:</span>
</span><span id="line-9"><span class="sd">        Formats and writes data to an Excel file.</span>
</span><span id="line-10"><span class="sd">    JSONWriter:</span>
</span><span id="line-11"><span class="sd">        Formats and writes data to a JSON file.</span>
</span><span id="line-12"><span class="sd">    LatexWriter:</span>
</span><span id="line-13"><span class="sd">        Formats and writes data to a LaTeX file using PyLaTeX.</span>
</span><span id="line-14"><span class="sd">    HTMLWriter:</span>
</span><span id="line-15"><span class="sd">        Formats and writes data to an HTML file.</span>
</span><span id="line-16"><span class="sd">    Presenter:</span>
</span><span id="line-17"><span class="sd">        Reads and processes GHG emission calculation results and outputs them </span>
</span><span id="line-18"><span class="sd">        using various writers.</span>
</span><span id="line-19">
</span><span id="line-20"><span class="sd">Functions:</span>
</span><span id="line-21"><span class="sd">    enforce_unity_sum(vector: List[float], epsilon: float = 0.001) -&gt; List[float]:</span>
</span><span id="line-22"><span class="sd">        Ensures the sum of values in a vector is approximately 1.0 within a given epsilon tolerance.</span>
</span><span id="line-23"><span class="sd">    landcover_pie(axis: plt.Axes, values: List[float], labels: List[str], colors: List[Any], </span>
</span><span id="line-24"><span class="sd">                  title: Optional[str] = None, show_legend: bool = False) -&gt; None:</span>
</span><span id="line-25"><span class="sd">        Creates a pie chart of land cover composition using matplotlib.</span>
</span><span id="line-26"><span class="sd">    parse_landcover_composition(vector: List[float]) -&gt; List[float]:</span>
</span><span id="line-27"><span class="sd">        Parses a vector representing land cover composition into a standardized format.</span>
</span><span id="line-28"><span class="sd">    write_par_to_dict(input_name: str, parameter: Any, par_dict: Dict, reservoir_name: str, </span>
</span><span id="line-29"><span class="sd">                      precision: int = 3) -&gt; Dict:</span>
</span><span id="line-30"><span class="sd">        Writes a parameter to a dictionary of parameter name-value pairs.</span>
</span><span id="line-31"><span class="sd">    rollout(var_name: str, var_vector: Union[Sequence, Dict]) -&gt; Iterator[Tuple[str, Any]]:</span>
</span><span id="line-32"><span class="sd">        Creates variable names and values from a sequence or dictionary.</span>
</span><span id="line-33"><span class="sd">    round_parameter(number: Union[float, list], number_decimals: int) -&gt; Union[float, list]:</span>
</span><span id="line-34"><span class="sd">        Rounds a number or each element in a list to the specified number of decimals.</span>
</span><span id="line-35">
</span><span id="line-36"><span class="sd">Notes:</span>
</span><span id="line-37"><span class="sd">    - Each writer class (ExcelWriter, JSONWriter, LatexWriter, HTMLWriter) is designed to handle </span>
</span><span id="line-38"><span class="sd">      specific output formats, ensuring the presentation of inputs, outputs, and internal variables </span>
</span><span id="line-39"><span class="sd">      in a structured manner.</span>
</span><span id="line-40"><span class="sd">    - All writer classes inherit from the abstract base class Writer, which enforces the implementation </span>
</span><span id="line-41"><span class="sd">      of the `write` method and provides utility methods such as `round_parameter`, `rollout`, and </span>
</span><span id="line-42"><span class="sd">      `write_par_to_dict`.</span>
</span><span id="line-43">
</span><span id="line-44"><span class="sd">Usage:</span>
</span><span id="line-45"><span class="sd">    [To be added later]</span>
</span><span id="line-46"><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-47"><span class="kn">import</span><span class="w"> </span><span class="nn">collections.abc</span>
</span><span id="line-48"><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
</span><span id="line-49"><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>
</span><span id="line-50"><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
</span><span id="line-51"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="line-52">    <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">)</span>
</span><span id="line-53"><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="line-54"><span class="kn">import</span><span class="w"> </span><span class="nn">configparser</span>
</span><span id="line-55"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="line-56"><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
</span><span id="line-57"><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
</span><span id="line-58"><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="line-59"><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="line-60"><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="line-61"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="line-62"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
</span><span id="line-63"><span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>
</span><span id="line-64"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="line-65"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="line-66"><span class="kn">from</span><span class="w"> </span><span class="nn">pylatex.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">bold</span>
</span><span id="line-67"><span class="kn">from</span><span class="w"> </span><span class="nn">pylatex.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompilerError</span>
</span><span id="line-68"><span class="kn">from</span><span class="w"> </span><span class="nn">pylatex</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="line-69">    <span class="n">PageStyle</span><span class="p">,</span>
</span><span id="line-70">    <span class="n">Head</span><span class="p">,</span>
</span><span id="line-71">    <span class="n">simple_page_number</span><span class="p">,</span>
</span><span id="line-72">    <span class="n">Figure</span><span class="p">,</span>
</span><span id="line-73">    <span class="n">NoEscape</span><span class="p">,</span>
</span><span id="line-74">    <span class="n">Tabu</span><span class="p">,</span>
</span><span id="line-75">    <span class="n">Center</span><span class="p">,</span>
</span><span id="line-76">    <span class="n">Quantity</span><span class="p">,</span>
</span><span id="line-77">    <span class="n">Description</span><span class="p">,</span>
</span><span id="line-78">    <span class="n">Document</span><span class="p">,</span>
</span><span id="line-79">    <span class="n">Section</span><span class="p">,</span>
</span><span id="line-80">    <span class="n">Subsection</span><span class="p">,</span>
</span><span id="line-81">    <span class="n">Command</span><span class="p">,</span>
</span><span id="line-82">    <span class="n">MultiColumn</span><span class="p">,</span>
</span><span id="line-83"><span class="p">)</span>
</span><span id="line-84"><span class="kn">from</span><span class="w"> </span><span class="nn">reemission.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_latex_installed</span><span class="p">,</span> <span class="n">safe_cast</span>
</span><span id="line-85"><span class="kn">from</span><span class="w"> </span><span class="nn">reemission.input</span><span class="w"> </span><span class="kn">import</span> <span class="n">Inputs</span>
</span><span id="line-86"><span class="kn">from</span><span class="w"> </span><span class="nn">reemission.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">Landuse</span>
</span><span id="line-87"><span class="kn">from</span><span class="w"> </span><span class="nn">reemission.auxiliary</span><span class="w"> </span><span class="kn">import</span> <span class="n">rollout_nested_list</span>
</span><span id="line-88"><span class="kn">from</span><span class="w"> </span><span class="nn">reemission.document_compiler</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchCompiler</span>
</span><span id="line-89"><span class="kn">from</span><span class="w"> </span><span class="nn">reemission</span><span class="w"> </span><span class="kn">import</span> <span class="n">registry</span>
</span><span id="line-90">
</span><span id="line-91"><span class="c1"># Set up module logger</span>
</span><span id="line-92"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="line-93"><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="line-94">
</span><span id="line-95"><span class="c1"># Format pyplot</span>
</span><span id="line-96"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="line-97">    <span class="p">{</span>
</span><span id="line-98">        <span class="s2">&quot;text.usetex&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="line-99">        <span class="s2">&quot;font.family&quot;</span><span class="p">:</span> <span class="s2">&quot;serif&quot;</span><span class="p">,</span>
</span><span id="line-100">        <span class="s2">&quot;font.serif&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Palatino&quot;</span><span class="p">],</span>
</span><span id="line-101">    <span class="p">}</span>
</span><span id="line-102"><span class="p">)</span>
</span><span id="line-103">
</span><span id="line-104"><span class="c1"># Plot parameters</span>
</span><span id="line-105"><span class="n">LABEL_FONTSIZE</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="line-106"><span class="n">TITLE_FONTSIZE</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="line-107"><span class="n">TICK_FONTSIZE</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="line-108"><span class="n">ANNOTATION_FONTSIZE</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="line-109">
</span><span id="line-110"><span class="c1"># JSONWriter parameters</span>
</span><span id="line-111"><span class="n">JSON_NUMBER_DECIMALS</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="line-112"><span class="n">EXCEL_NUMBER_DECIMALS</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="line-113">
</span><span id="line-114"><span class="c1"># TODO: Create this list from True/False values in the input config YAML file</span>
</span><span id="line-115"><span class="n">INPUT_NAMES</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="line-116">    <span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly_temps&#39;</span><span class="p">,</span> <span class="s1">&#39;biogenic_factors&#39;</span><span class="p">,</span>
</span><span id="line-117">    <span class="s1">&#39;year_profile&#39;</span><span class="p">,</span> <span class="s1">&#39;catchment_inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">,</span>
</span><span id="line-118">    <span class="s1">&#39;gasses&#39;</span><span class="p">]</span>
</span><span id="line-119">
</span><span id="line-120"><span class="n">FACTOR_NAMES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-121">    <span class="s2">&quot;biome&quot;</span><span class="p">:</span> <span class="s2">&quot;Biome&quot;</span><span class="p">,</span>
</span><span id="line-122">    <span class="s2">&quot;climate&quot;</span><span class="p">:</span> <span class="s2">&quot;Climate&quot;</span><span class="p">,</span>
</span><span id="line-123">    <span class="s2">&quot;soil_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Soil Type&quot;</span><span class="p">,</span>
</span><span id="line-124">    <span class="s2">&quot;treatment_factor&quot;</span><span class="p">:</span> <span class="s2">&quot;Treatment Factor&quot;</span><span class="p">,</span>
</span><span id="line-125">    <span class="s2">&quot;landuse_intensity&quot;</span><span class="p">:</span> <span class="s2">&quot;Landuse Intensity&quot;</span><span class="p">,</span>
</span><span id="line-126"><span class="p">}</span>
</span><span id="line-127">
</span><span id="line-128"><span class="n">landcover_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="line-129">    <span class="n">landcover</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">landcover</span> <span class="ow">in</span> <span class="n">Landuse</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;_member_map_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="line-130">
</span><span id="line-131"><span class="k">def</span><span class="w"> </span><span class="nf">_get_latex_compiler</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-132"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-133"><span class="sd">    Retrieves the LaTeX compiler to be used based on application configuration.</span>
</span><span id="line-134">
</span><span id="line-135"><span class="sd">    Returns:</span>
</span><span id="line-136"><span class="sd">        str: The LaTeX compiler to be used. Defaults to &#39;pdflatex&#39; if no specific compiler</span>
</span><span id="line-137"><span class="sd">             is configured or if the configured compiler is not recognized.</span>
</span><span id="line-138">
</span><span id="line-139"><span class="sd">    Note:</span>
</span><span id="line-140"><span class="sd">        This function reads the LaTeX compiler setting from the application configuration</span>
</span><span id="line-141"><span class="sd">        (app_config[&#39;latex&#39;][&#39;compiler&#39;]). If the configured compiler is &#39;pdflatex&#39; or </span>
</span><span id="line-142"><span class="sd">        &#39;latexmk&#39;, it returns that compiler. Otherwise, it falls back to the default </span>
</span><span id="line-143"><span class="sd">        compiler &#39;pdflatex&#39;.</span>
</span><span id="line-144">
</span><span id="line-145"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-146">    <span class="n">default_compiler</span> <span class="o">=</span> <span class="s1">&#39;pdflatex&#39;</span>
</span><span id="line-147">    <span class="n">app_config</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_config&quot;</span><span class="p">)</span>
</span><span id="line-148">    <span class="k">try</span><span class="p">:</span>
</span><span id="line-149">        <span class="n">latex_options</span> <span class="o">=</span> <span class="n">app_config</span><span class="p">[</span><span class="s1">&#39;latex&#39;</span><span class="p">]</span>
</span><span id="line-150">        <span class="n">compiler</span> <span class="o">=</span> <span class="n">latex_options</span><span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">]</span>
</span><span id="line-151">        <span class="k">if</span> <span class="n">compiler</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;pdflatex&#39;</span><span class="p">,</span> <span class="s1">&#39;latexmk&#39;</span><span class="p">):</span>
</span><span id="line-152">            <span class="k">return</span> <span class="n">compiler</span>
</span><span id="line-153">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-154">            <span class="k">return</span> <span class="n">default_compiler</span>
</span><span id="line-155">    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-156">        <span class="k">return</span> <span class="s1">&#39;pdflatex&#39;</span>
</span><span id="line-157">
</span><span id="line-158">
<div class="viewcode-block" id="format_number">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.format_number">[docs]</a>
</span><span id="line-159"><span class="k">def</span><span class="w"> </span><span class="nf">format_number</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-160"><span class="w">    </span><span class="sd">&quot;&quot;&quot; Formats a number for display in a human-readable way.</span>
</span><span id="line-161"><span class="sd">    Args:</span>
</span><span id="line-162"><span class="sd">        x (Any): The number to format. It can be an int, float, or None.</span>
</span><span id="line-163"><span class="sd">    Returns:</span>
</span><span id="line-164"><span class="sd">        str: A string representation of the number formatted for readability.</span>
</span><span id="line-165"><span class="sd">    Note:</span>
</span><span id="line-166"><span class="sd">        - If `x` is None, it returns &quot;—&quot; (or &quot;N/A&quot;).</span>
</span><span id="line-167"><span class="sd">        - If `x` is an integer, it returns the integer as a string.</span>
</span><span id="line-168"><span class="sd">        - For floats, it formats them based on their magnitude:</span>
</span><span id="line-169"><span class="sd">            - Very large or very negative values are formatted with 1 decimal point.</span>
</span><span id="line-170"><span class="sd">            - Moderate values are formatted with up to 5 significant digits.</span>
</span><span id="line-171"><span class="sd">            - Very small values are formatted with 3 significant digits.</span>
</span><span id="line-172"><span class="sd">            - Extremely small values are formatted in engineering notation.</span>
</span><span id="line-173"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-174">    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-175">        <span class="k">return</span> <span class="s2">&quot;—&quot;</span>  <span class="c1"># or &quot;N/A&quot;</span>
</span><span id="line-176">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="line-177">        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="line-178">    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="line-179">        <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
</span><span id="line-180">
</span><span id="line-181">    <span class="n">abs_x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="line-182">
</span><span id="line-183">    <span class="c1"># Very large or very negative values: 1 decimal point</span>
</span><span id="line-184">    <span class="k">if</span> <span class="n">abs_x</span> <span class="o">&gt;=</span> <span class="mf">1e4</span><span class="p">:</span>
</span><span id="line-185">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="line-186">
</span><span id="line-187">    <span class="c1"># Moderate range: up to 5 significant digits</span>
</span><span id="line-188">    <span class="k">elif</span> <span class="n">abs_x</span> <span class="o">&gt;=</span> <span class="mf">1e-3</span><span class="p">:</span>
</span><span id="line-189">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.5g</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="line-190">
</span><span id="line-191">    <span class="c1"># Very small values</span>
</span><span id="line-192">    <span class="k">elif</span> <span class="n">abs_x</span> <span class="o">&gt;=</span> <span class="mf">1e-5</span><span class="p">:</span>
</span><span id="line-193">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.3g</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="line-194">
</span><span id="line-195">    <span class="c1"># Extremely small → engineering notation</span>
</span><span id="line-196">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-197">        <span class="n">exponent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">abs_x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="line-198">        <span class="n">mantissa</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">exponent</span><span class="p">)</span>
</span><span id="line-199">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mantissa</span><span class="si">:</span><span class="s2">.3g</span><span class="si">}</span><span class="s2">e</span><span class="si">{</span><span class="n">exponent</span><span class="si">:</span><span class="s2">+d</span><span class="si">}</span><span class="s2">&quot;</span></div>

</span><span id="line-200">
</span><span id="line-201">
<div class="viewcode-block" id="parse_landcover_composition">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.parse_landcover_composition">[docs]</a>
</span><span id="line-202"><span class="k">def</span><span class="w"> </span><span class="nf">parse_landcover_composition</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="line-203"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-204"><span class="sd">    Parses a vector representing land cover composition into a standardized format.</span>
</span><span id="line-205">
</span><span id="line-206"><span class="sd">    Args:</span>
</span><span id="line-207"><span class="sd">        vector (List[float]): </span>
</span><span id="line-208"><span class="sd">            A vector representing land cover composition. </span>
</span><span id="line-209"><span class="sd">            It should be either a 9-element vector or a 27-element vector.</span>
</span><span id="line-210">
</span><span id="line-211"><span class="sd">    Returns:</span>
</span><span id="line-212"><span class="sd">        List[float]: </span>
</span><span id="line-213"><span class="sd">            A 9-element vector representing the parsed land cover composition.</span>
</span><span id="line-214">
</span><span id="line-215"><span class="sd">    Raises:</span>
</span><span id="line-216"><span class="sd">        ValueError: If the provided vector does not have a length of 9 or 27.</span>
</span><span id="line-217">
</span><span id="line-218"><span class="sd">    Note:</span>
</span><span id="line-219"><span class="sd">        - If the input vector length is 9, it is returned as-is.</span>
</span><span id="line-220"><span class="sd">        - If the input vector length is 27, it is split into three equal parts,</span>
</span><span id="line-221"><span class="sd">          each part is summed element-wise, resulting in a 9-element vector.</span>
</span><span id="line-222"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-223">    <span class="n">vector_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span id="line-224">    <span class="n">supported_vector_lengths</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>
</span><span id="line-225">    <span class="k">try</span><span class="p">:</span>
</span><span id="line-226">        <span class="k">assert</span> <span class="n">vector_length</span> <span class="ow">in</span> <span class="n">supported_vector_lengths</span>
</span><span id="line-227">    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="line-228">        <span class="n">vector_sizes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">supported_vector_lengths</span><span class="p">))</span>
</span><span id="line-229">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="line-230">            <span class="sa">f</span><span class="s2">&quot;Supported vector sizes: </span><span class="si">{</span><span class="n">vector_sizes</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="line-231">            <span class="sa">f</span><span class="s2">&quot;Provided vector has size </span><span class="si">{</span><span class="n">vector_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
</span><span id="line-232">    <span class="k">if</span> <span class="n">vector_length</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
</span><span id="line-233">        <span class="k">return</span> <span class="n">vector</span>
</span><span id="line-234">    <span class="c1"># Fold the 27x1 vector into three parts and sum the 9x1 vectors</span>
</span><span id="line-235">    <span class="n">len_list</span> <span class="o">=</span> <span class="n">vector_length</span> <span class="o">//</span> <span class="mi">3</span>
</span><span id="line-236">    <span class="n">sublist1</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[:</span><span class="n">len_list</span><span class="p">]</span>
</span><span id="line-237">    <span class="n">sublist2</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="n">len_list</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">len_list</span><span class="p">]</span>
</span><span id="line-238">    <span class="n">sublist3</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">len_list</span><span class="p">:]</span>
</span><span id="line-239">    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span>
</span><span id="line-240">        <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> 
</span><span id="line-241">            <span class="p">[</span><span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="p">))],</span> 
</span><span id="line-242">            <span class="p">[</span><span class="n">sublist1</span><span class="p">,</span> <span class="n">sublist2</span><span class="p">,</span> <span class="n">sublist3</span><span class="p">])</span></div>

</span><span id="line-243">
</span><span id="line-244">
<div class="viewcode-block" id="enforce_unity_sum">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.enforce_unity_sum">[docs]</a>
</span><span id="line-245"><span class="k">def</span><span class="w"> </span><span class="nf">enforce_unity_sum</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="line-246"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-247"><span class="sd">    Ensures the sum of values in the vector is approximately 1.0 within a given epsilon </span>
</span><span id="line-248"><span class="sd">    tolerance.</span>
</span><span id="line-249">
</span><span id="line-250"><span class="sd">    Args:</span>
</span><span id="line-251"><span class="sd">        vector (List[float]): The input vector of float values to be normalized.</span>
</span><span id="line-252"><span class="sd">        epsilon (float, optional): </span>
</span><span id="line-253"><span class="sd">            Tolerance level around 1.0 within which the sum of the vector</span>
</span><span id="line-254"><span class="sd">            should lie. Defaults to 0.001.</span>
</span><span id="line-255">
</span><span id="line-256"><span class="sd">    Returns:</span>
</span><span id="line-257"><span class="sd">        List[float]: A normalized vector where the sum of values is approximately 1.0.</span>
</span><span id="line-258">
</span><span id="line-259"><span class="sd">    Note:</span>
</span><span id="line-260"><span class="sd">        - If the sum of values in the input vector is not within the range [1.0 - epsilon, 1.0 + epsilon],</span>
</span><span id="line-261"><span class="sd">          the vector is normalized by dividing each element by the current sum of the vector.</span>
</span><span id="line-262">
</span><span id="line-263"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-264">    <span class="k">if</span> <span class="ow">not</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">epsilon</span> <span class="o">&lt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">:</span>
</span><span id="line-265">        <span class="c1"># TODO: Add warning, maybe to a logger.</span>
</span><span id="line-266">        <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">vector</span><span class="p">]</span>
</span><span id="line-267">    <span class="k">return</span> <span class="n">vector</span></div>

</span><span id="line-268">
</span><span id="line-269">
</span><span id="line-270"><span class="n">landcover_cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral&#39;</span><span class="p">)</span>
</span><span id="line-271"><span class="n">landcover_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">landcover_cmap</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>
</span><span id="line-272">
</span><span id="line-273">
<div class="viewcode-block" id="landcover_pie">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.landcover_pie">[docs]</a>
</span><span id="line-274"><span class="k">def</span><span class="w"> </span><span class="nf">landcover_pie</span><span class="p">(</span>
</span><span id="line-275">        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">colors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span id="line-276">        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-277"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-278"><span class="sd">    Creates a pie chart of land cover composition.</span>
</span><span id="line-279">
</span><span id="line-280"><span class="sd">    Args:</span>
</span><span id="line-281"><span class="sd">        axis (plt.Axes): The matplotlib axis object where the pie chart will be drawn.</span>
</span><span id="line-282"><span class="sd">        values (List[float]): List of float values representing the proportions of each land cover type.</span>
</span><span id="line-283"><span class="sd">        labels (List[str]): List of strings representing labels for each land cover type.</span>
</span><span id="line-284"><span class="sd">        colors (List[Any]): List of colors corresponding to each land cover type.</span>
</span><span id="line-285"><span class="sd">        title (str, optional): Title of the pie chart. Defaults to None.</span>
</span><span id="line-286"><span class="sd">        show_legend (bool, optional): Whether to display the legend. Defaults to False.</span>
</span><span id="line-287">
</span><span id="line-288"><span class="sd">    Returns:</span>
</span><span id="line-289"><span class="sd">        None</span>
</span><span id="line-290">
</span><span id="line-291"><span class="sd">    Note:</span>
</span><span id="line-292"><span class="sd">        - The function creates a pie chart using matplotlib on the provided axis (`axis`).</span>
</span><span id="line-293"><span class="sd">        - Only land cover types with non-zero values (`values &gt; 0`) are included in the chart.</span>
</span><span id="line-294"><span class="sd">        - The pie is exploded to highlight the land cover type with the highest proportion.</span>
</span><span id="line-295"><span class="sd">        - Labels and percentages are formatted and positioned for readability.</span>
</span><span id="line-296">
</span><span id="line-297"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-298">    <span class="n">explode_offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>
</span><span id="line-299">    <span class="n">labels_tr</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</span><span id="line-300">    <span class="n">values_tr</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</span><span id="line-301">    <span class="n">colors_tr</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span> <span class="k">for</span> <span class="n">color</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</span><span id="line-302">    <span class="c1"># Explode the pie with the highest value</span>
</span><span id="line-303">    <span class="n">max_value_index</span> <span class="o">=</span> <span class="n">values_tr</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">values_tr</span><span class="p">))</span>
</span><span id="line-304">    <span class="n">one_hot_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values_tr</span><span class="p">)</span>
</span><span id="line-305">    <span class="n">one_hot_list</span><span class="p">[</span><span class="n">max_value_index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="line-306">    <span class="n">explode</span> <span class="o">=</span> <span class="p">[</span><span class="n">explode_offset</span> <span class="o">*</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">one_hot_list</span><span class="p">]</span>
</span><span id="line-307">
</span><span id="line-308">    <span class="n">axis</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">values_tr</span><span class="p">,</span> 
</span><span id="line-309">        <span class="n">labels</span><span class="o">=</span><span class="n">labels_tr</span><span class="p">,</span> 
</span><span id="line-310">        <span class="n">explode</span><span class="o">=</span><span class="n">explode</span><span class="p">,</span>
</span><span id="line-311">        <span class="n">pctdistance</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> 
</span><span id="line-312">        <span class="n">labeldistance</span> <span class="o">=</span> <span class="mf">1.1</span><span class="p">,</span>
</span><span id="line-313">        <span class="n">wedgeprops</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;edgecolor&quot;</span><span class="p">:</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
</span><span id="line-314">        <span class="n">startangle</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
</span><span id="line-315">        <span class="n">autopct</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
</span><span id="line-316">        <span class="n">textprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> 
</span><span id="line-317">        <span class="n">radius</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="line-318">        <span class="n">colors</span> <span class="o">=</span> <span class="n">colors_tr</span>
</span><span id="line-319">        <span class="p">)</span>
</span><span id="line-320">    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="line-321">        <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
</span><span id="line-322">    <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
</span><span id="line-323">        <span class="n">legend</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
</span><span id="line-324">            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="line-325">        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">legend</span><span class="o">.</span><span class="n">get_texts</span><span class="p">():</span>
</span><span id="line-326">            <span class="n">text</span><span class="o">.</span><span class="n">set_fontstyle</span><span class="p">(</span><span class="s2">&quot;italic&quot;</span><span class="p">)</span>
</span><span id="line-327">            <span class="n">text</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span></div>

</span><span id="line-328">
</span><span id="line-329">
<div class="viewcode-block" id="emission_profile">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.emission_profile">[docs]</a>
</span><span id="line-330"><span class="k">def</span><span class="w"> </span><span class="nf">emission_profile</span><span class="p">(</span>
</span><span id="line-331">        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
</span><span id="line-332">        <span class="n">years</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="line-333">        <span class="n">emissions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="line-334">        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-335">        <span class="n">y_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-336">        <span class="n">annotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-337"><span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots a profile of emissions over time.</span>
</span><span id="line-338">
</span><span id="line-339"><span class="sd">    Args:</span>
</span><span id="line-340"><span class="sd">        axis (plt.Axes): Matplotlib axes object.</span>
</span><span id="line-341"><span class="sd">        years (List[int]): List of years corresponding to the emissions.</span>
</span><span id="line-342"><span class="sd">        emissions (List[float]): List of emissions corresponding to the years.</span>
</span><span id="line-343"><span class="sd">        title (str): Title of the plot.</span>
</span><span id="line-344"><span class="sd">        y_label (str): Label for the y-axis.</span>
</span><span id="line-345"><span class="sd">        annotate (bool): Flag setting whether emission values are added to plot. Default is True.</span>
</span><span id="line-346"><span class="sd">    Raises:</span>
</span><span id="line-347"><span class="sd">        ValueError: If the lengths of years and emissions do not match, or if they contain non-numeric values.</span>
</span><span id="line-348"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-349">    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-350">        <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> 
</span><span id="line-351">        <span class="s1">&#39;axiswidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
</span><span id="line-352">        <span class="s1">&#39;tickwidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="line-353">        <span class="s1">&#39;labelpad&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> 
</span><span id="line-354">        <span class="s1">&#39;titlepad&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="line-355">        <span class="s1">&#39;label_fontsize&#39;</span><span class="p">:</span> <span class="n">LABEL_FONTSIZE</span><span class="p">,</span>
</span><span id="line-356">        <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="n">TITLE_FONTSIZE</span><span class="p">,</span>
</span><span id="line-357">        <span class="s1">&#39;tick_fontsize&#39;</span><span class="p">:</span> <span class="n">TICK_FONTSIZE</span><span class="p">,</span>
</span><span id="line-358">        <span class="s1">&#39;annotation_fontsize&#39;</span><span class="p">:</span> <span class="n">ANNOTATION_FONTSIZE</span><span class="p">}</span>
</span><span id="line-359">
</span><span id="line-360">    <span class="c1"># Get the x and y data</span>
</span><span id="line-361">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">emissions</span><span class="p">):</span>
</span><span id="line-362">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="line-363">            <span class="sa">f</span><span class="s2">&quot;Years and emissions must have the same length, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">emissions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="line-364">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">):</span>
</span><span id="line-365">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All emissions must be numeric (int or float).&quot;</span><span class="p">)</span>
</span><span id="line-366">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">emission</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">emission</span> <span class="ow">in</span> <span class="n">emissions</span><span class="p">):</span>
</span><span id="line-367">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All emissions must be numeric (int or float).&quot;</span><span class="p">)</span>
</span><span id="line-368">    <span class="n">x_data</span> <span class="o">=</span> <span class="n">years</span>
</span><span id="line-369">    <span class="n">y_data</span> <span class="o">=</span> <span class="n">emissions</span>
</span><span id="line-370">    <span class="c1"># Format plot</span>
</span><span id="line-371">    <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
</span><span id="line-372">                <span class="n">linewidth</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>
</span><span id="line-373">    <span class="n">axis</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="line-374">    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">],</span>
</span><span id="line-375">                    <span class="n">labelpad</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;labelpad&#39;</span><span class="p">])</span>
</span><span id="line-376">    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time, years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">],</span>
</span><span id="line-377">                    <span class="n">labelpad</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;labelpad&#39;</span><span class="p">])</span>
</span><span id="line-378">    <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">],</span>
</span><span id="line-379">                    <span class="n">pad</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;titlepad&#39;</span><span class="p">])</span>
</span><span id="line-380">    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;tick_fontsize&#39;</span><span class="p">])</span>
</span><span id="line-381">    <span class="c1"># Make the (visible) axes thicker</span>
</span><span id="line-382">    <span class="k">for</span> <span class="n">axis_pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">]:</span>
</span><span id="line-383">        <span class="n">axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis_pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;axiswidth&#39;</span><span class="p">])</span>
</span><span id="line-384">    <span class="c1"># Increase tick width</span>
</span><span id="line-385">    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;tickwidth&#39;</span><span class="p">])</span>
</span><span id="line-386">    <span class="n">axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-387">    <span class="n">axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-388">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-389">    <span class="c1"># Add emission values (numbers) to the plot</span>
</span><span id="line-390">    <span class="k">if</span> <span class="n">annotate</span><span class="p">:</span>
</span><span id="line-391">        <span class="k">for</span> <span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">):</span>
</span><span id="line-392">            <span class="n">axis</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
</span><span id="line-393">                <span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{:.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_coord</span><span class="p">),</span>
</span><span id="line-394">                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">),</span>
</span><span id="line-395">                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="line-396">                <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span>
</span><span id="line-397">                <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;annotation_fontsize&#39;</span><span class="p">])</span></div>

</span><span id="line-398">            
<div class="viewcode-block" id="emission_bars">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.emission_bars">[docs]</a>
</span><span id="line-399"><span class="k">def</span><span class="w"> </span><span class="nf">emission_bars</span><span class="p">(</span>
</span><span id="line-400">        <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
</span><span id="line-401">        <span class="n">gases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="line-402">        <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="line-403">        <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-404"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize total emissions (unit x surface area) for the calculated gases.</span>
</span><span id="line-405">
</span><span id="line-406"><span class="sd">    Args:</span>
</span><span id="line-407"><span class="sd">        axis (plt.Axes): Matplotlib axes object.</span>
</span><span id="line-408"><span class="sd">        gases (List[str]): List of gas names to be displayed on the y-axis.</span>
</span><span id="line-409"><span class="sd">        values (List[float]): List of total annual emissions for each gas.</span>
</span><span id="line-410"><span class="sd">        output_name (str): Name of the output/reservoir.</span>
</span><span id="line-411"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-412">    <span class="n">plot_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-413">        <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="line-414">        <span class="s1">&#39;axiswidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="line-415">        <span class="s1">&#39;tickwidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="line-416">        <span class="s1">&#39;labelpad&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> 
</span><span id="line-417">        <span class="s1">&#39;titlepad&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
</span><span id="line-418">        <span class="s1">&#39;label_fontsize&#39;</span><span class="p">:</span> <span class="n">LABEL_FONTSIZE</span><span class="p">,</span>
</span><span id="line-419">        <span class="s1">&#39;title_fontsize&#39;</span><span class="p">:</span> <span class="n">TITLE_FONTSIZE</span><span class="p">,</span>
</span><span id="line-420">        <span class="s1">&#39;tick_fontsize&#39;</span><span class="p">:</span> <span class="n">TICK_FONTSIZE</span><span class="p">,</span>
</span><span id="line-421">        <span class="s1">&#39;annotation_fontsize&#39;</span><span class="p">:</span> <span class="n">ANNOTATION_FONTSIZE</span><span class="p">}</span>
</span><span id="line-422">
</span><span id="line-423">    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gases</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="line-424">    <span class="n">axis</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</span><span id="line-425">    <span class="n">axis</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">,</span> <span class="n">gases</span><span class="p">)</span>
</span><span id="line-426">    <span class="c1">#axis.tick_params(fontsize=plot_options[&#39;tick_fontsize&#39;])</span>
</span><span id="line-427">    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;tick_fontsize&#39;</span><span class="p">])</span>
</span><span id="line-428">    <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Total annual emission, tonnes CO$_{2,eq}$ yr$^{-1}$&quot;</span><span class="p">,</span>
</span><span id="line-429">                    <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">])</span>
</span><span id="line-430">    <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Gas&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">])</span>
</span><span id="line-431">    <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Total annual emission, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_name</span><span class="p">),</span>
</span><span id="line-432">                    <span class="n">fontsize</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">],</span>
</span><span id="line-433">                    <span class="n">pad</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;titlepad&#39;</span><span class="p">])</span>
</span><span id="line-434">    <span class="c1"># Make the (visible) axes thicker</span>
</span><span id="line-435">    <span class="k">for</span> <span class="n">axis_pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">]:</span>
</span><span id="line-436">        <span class="n">axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis_pos</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;axiswidth&#39;</span><span class="p">])</span>
</span><span id="line-437">    <span class="c1"># Increase tick width</span>
</span><span id="line-438">    <span class="n">axis</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">plot_options</span><span class="p">[</span><span class="s1">&#39;tickwidth&#39;</span><span class="p">])</span>
</span><span id="line-439">    <span class="n">axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-440">    <span class="n">axis</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

</span><span id="line-441">
</span><span id="line-442">
<div class="viewcode-block" id="Writer">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Writer">[docs]</a>
</span><span id="line-443"><span class="nd">@dataclass</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="line-444"><span class="k">class</span><span class="w"> </span><span class="nc">Writer</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="line-445"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-446"><span class="sd">    Abstract base class for all writers.</span>
</span><span id="line-447"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-448">
<div class="viewcode-block" id="Writer.round_parameter">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Writer.round_parameter">[docs]</a>
</span><span id="line-449">    <span class="nd">@staticmethod</span>
</span><span id="line-450">    <span class="k">def</span><span class="w"> </span><span class="nf">round_parameter</span><span class="p">(</span>
</span><span id="line-451">            <span class="n">number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
</span><span id="line-452">            <span class="n">number_decimals</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="line-453"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-454"><span class="sd">        Rounds a number or each element in a list to the specified number of decimals.</span>
</span><span id="line-455">
</span><span id="line-456"><span class="sd">        Args:</span>
</span><span id="line-457"><span class="sd">            number (Union[float, list]): The number or list of numbers to round.</span>
</span><span id="line-458"><span class="sd">            number_decimals (int): Number of decimal places to round to.</span>
</span><span id="line-459">
</span><span id="line-460"><span class="sd">        Returns:</span>
</span><span id="line-461"><span class="sd">            Union[float, list]: Rounded number or list of rounded numbers.</span>
</span><span id="line-462"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-463">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-464">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="line-465">                <span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">number_decimals</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">number</span><span class="p">]</span>
</span><span id="line-466">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-467">                <span class="n">number</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">number_decimals</span><span class="p">)</span>
</span><span id="line-468">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="line-469">            <span class="k">pass</span>
</span><span id="line-470">        <span class="k">return</span> <span class="n">number</span></div>

</span><span id="line-471">
<div class="viewcode-block" id="Writer.rollout">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Writer.rollout">[docs]</a>
</span><span id="line-472">    <span class="nd">@staticmethod</span>
</span><span id="line-473">    <span class="k">def</span><span class="w"> </span><span class="nf">rollout</span><span class="p">(</span>
</span><span id="line-474">            <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-475">            <span class="n">var_vector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="line-476"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-477"><span class="sd">        Creates variable names and values from a sequence or dictionary.</span>
</span><span id="line-478">
</span><span id="line-479"><span class="sd">        Args:</span>
</span><span id="line-480"><span class="sd">            var_name (str): Base name for the variables.</span>
</span><span id="line-481"><span class="sd">            var_vector (Union[Sequence, Dict]): Sequence or dictionary containing variable values.</span>
</span><span id="line-482">
</span><span id="line-483"><span class="sd">        Yields:</span>
</span><span id="line-484"><span class="sd">            Iterator[Tuple[str, Any]]: Iterator yielding tuples of variable names and values.</span>
</span><span id="line-485"><span class="sd">            </span>
</span><span id="line-486"><span class="sd">        Example:</span>
</span><span id="line-487"><span class="sd">            a variable var = [3,4,5] becomes: (&#39;var_0&#39;, 3), (&#39;var_1&#39;, 4),</span>
</span><span id="line-488"><span class="sd">            (&#39;var_2&#39;, 5).</span>
</span><span id="line-489"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-490">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_vector</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="line-491">            <span class="k">for</span> <span class="n">iter_var</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_vector</span><span class="p">):</span>
</span><span id="line-492">                <span class="k">yield</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">iter_var</span><span class="p">)]),</span> <span class="n">var</span></div>

</span><span id="line-493">
<div class="viewcode-block" id="Writer.write_par_to_dict">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Writer.write_par_to_dict">[docs]</a>
</span><span id="line-494">    <span class="nd">@staticmethod</span>
</span><span id="line-495">    <span class="k">def</span><span class="w"> </span><span class="nf">write_par_to_dict</span><span class="p">(</span><span class="n">input_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parameter</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">par_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="line-496">                          <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="line-497"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-498"><span class="sd">        Writes a parameter to a dictionary of parameter name-value pairs.</span>
</span><span id="line-499">
</span><span id="line-500"><span class="sd">        Args:</span>
</span><span id="line-501"><span class="sd">            input_name (str): Name of the input parameter.</span>
</span><span id="line-502"><span class="sd">            parameter (Any): Parameter data. It can be a single value, sequence, or nested sequence.</span>
</span><span id="line-503"><span class="sd">            par_dict (Dict): Dictionary of parameter names and values in the form {reservoir_name: {par_name: par_values}}.</span>
</span><span id="line-504"><span class="sd">            reservoir_name (str): Name of the reservoir for which the parameter is to be added.</span>
</span><span id="line-505"><span class="sd">            precision (int, optional): Number of decimal points for the parameter. Defaults to 3.</span>
</span><span id="line-506">
</span><span id="line-507"><span class="sd">        Returns:</span>
</span><span id="line-508"><span class="sd">            Dict: Updated dictionary of parameter names and values.</span>
</span><span id="line-509"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-510">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-511">            <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">input_name</span><span class="p">:</span> <span class="n">parameter</span><span class="p">}</span>
</span><span id="line-512">            <span class="n">par_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
</span><span id="line-513">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="line-514">            <span class="n">nested_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="line-515">            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parameter</span><span class="p">:</span>
</span><span id="line-516">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
</span><span id="line-517">                    <span class="n">nested_list</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="line-518">                    <span class="k">break</span>
</span><span id="line-519">            <span class="k">if</span> <span class="n">nested_list</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="line-520">                <span class="n">parameter</span> <span class="o">=</span> <span class="n">rollout_nested_list</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="line-521">            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">Writer</span><span class="o">.</span><span class="n">rollout</span><span class="p">(</span><span class="n">input_name</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
</span><span id="line-522">                <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">Writer</span><span class="o">.</span><span class="n">round_parameter</span><span class="p">(</span>
</span><span id="line-523">                    <span class="n">value</span><span class="p">,</span> <span class="n">precision</span><span class="p">)}</span>
</span><span id="line-524">                <span class="n">par_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
</span><span id="line-525">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-526">            <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">input_name</span><span class="p">:</span> <span class="n">Writer</span><span class="o">.</span><span class="n">round_parameter</span><span class="p">(</span>
</span><span id="line-527">                <span class="n">parameter</span><span class="p">,</span> <span class="n">precision</span><span class="p">)}</span>
</span><span id="line-528">            <span class="n">par_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
</span><span id="line-529">        <span class="k">return</span> <span class="n">par_dict</span></div>

</span><span id="line-530">
<div class="viewcode-block" id="Writer.write">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Writer.write">[docs]</a>
</span><span id="line-531">    <span class="nd">@abstractmethod</span>
</span><span id="line-532">    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-533"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-534"><span class="sd">        Writes outputs to the format of choice.</span>
</span><span id="line-535"><span class="sd">        &quot;&quot;&quot;</span></div>
</div>

</span><span id="line-536">
</span><span id="line-537">
<div class="viewcode-block" id="ExcelWriter">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter">[docs]</a>
</span><span id="line-538"><span class="nd">@dataclass</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="line-539"><span class="k">class</span><span class="w"> </span><span class="nc">ExcelWriter</span><span class="p">(</span><span class="n">Writer</span><span class="p">):</span>
</span><span id="line-540"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-541"><span class="sd">    Formats and writes data to an Excel file.</span>
</span><span id="line-542">
</span><span id="line-543"><span class="sd">    Attributes:</span>
</span><span id="line-544"><span class="sd">        inputs (Inputs): Inputs object containing input data.</span>
</span><span id="line-545"><span class="sd">        outputs (Dict): Outputs dictionary.</span>
</span><span id="line-546"><span class="sd">        intern_vars (Dict): Internal variables dictionary.</span>
</span><span id="line-547"><span class="sd">        output_file_path (str): Path where the output Excel file will be saved.</span>
</span><span id="line-548"><span class="sd">        output_config (Dict): Configuration file with formatting settings for outputs.</span>
</span><span id="line-549"><span class="sd">        input_config (Dict): Configuration file with formatting settings for inputs.</span>
</span><span id="line-550"><span class="sd">        intern_vars_config (Dict): Configuration dictionary with formatting settings for internal variables.</span>
</span><span id="line-551"><span class="sd">        parameter_config (Dict): Configuration file with formatting settings for parameters.</span>
</span><span id="line-552"><span class="sd">        config_ini (Dict): Global parameter configuration dict (usually from .ini file).</span>
</span><span id="line-553"><span class="sd">        author (str): Author of the Excel document.</span>
</span><span id="line-554"><span class="sd">        title (str): Title of the Excel document.</span>
</span><span id="line-555"><span class="sd">        output_df (pd.DataFrame): DataFrame containing model outputs.</span>
</span><span id="line-556"><span class="sd">        input_df (pd.DataFrame): DataFrame containing model inputs.</span>
</span><span id="line-557"><span class="sd">        intern_vars_df (pd.DataFrame): DataFrame containing internal variables.</span>
</span><span id="line-558"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-559">
</span><span id="line-560">    <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span>
</span><span id="line-561">    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-562">    <span class="n">intern_vars</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-563">
</span><span id="line-564">    <span class="n">output_file_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-565">
</span><span id="line-566">    <span class="n">output_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-567">    <span class="n">input_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-568">    <span class="n">intern_vars_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-569">
</span><span id="line-570">    <span class="n">parameter_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-571">    <span class="n">config_ini</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-572">    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-573">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-574">
</span><span id="line-575">    <span class="n">output_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-576">    <span class="n">input_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-577">    <span class="n">intern_vars_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-578">
<div class="viewcode-block" id="ExcelWriter.__post_init__">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter.__post_init__">[docs]</a>
</span><span id="line-579">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-580"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-581"><span class="sd">        Initialize output DataFrames which will be output as Excel sheets.</span>
</span><span id="line-582"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-583">        <span class="bp">self</span><span class="o">.</span><span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="line-584">        <span class="bp">self</span><span class="o">.</span><span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="line-585">        <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

</span><span id="line-586">
<div class="viewcode-block" id="ExcelWriter.add_inputs">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter.add_inputs">[docs]</a>
</span><span id="line-587">    <span class="k">def</span><span class="w"> </span><span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-588"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-589"><span class="sd">        Create an inputs DataFrame for a given reservoir and append it to the main input DataFrame.</span>
</span><span id="line-590">
</span><span id="line-591"><span class="sd">        Args:</span>
</span><span id="line-592"><span class="sd">            reservoir_name (str): Name of the reservoir for which inputs are to be added.</span>
</span><span id="line-593"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-594">        <span class="n">input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</span><span id="line-595">        <span class="n">input_dict</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">reservoir_name</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="line-596">
</span><span id="line-597">        <span class="c1"># Find out which inputs to include in the presentation</span>
</span><span id="line-598">        <span class="n">included_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-599">        <span class="k">for</span> <span class="n">input_name</span> <span class="ow">in</span> <span class="n">INPUT_NAMES</span><span class="p">:</span>
</span><span id="line-600">            <span class="n">input_data_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-601">            <span class="k">if</span> <span class="n">input_data_conf</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-602">                <span class="n">included_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>
</span><span id="line-603">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">included_inputs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="line-604">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-605">
</span><span id="line-606">        <span class="c1"># Mapping between input names and input names in the Input.data dict.</span>
</span><span id="line-607">        <span class="n">config_to_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span>
</span><span id="line-608">                          <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span id="line-609">                          <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
</span><span id="line-610">                          <span class="s2">&quot;monthly_temps&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_temps&quot;</span><span class="p">,</span>
</span><span id="line-611">                          <span class="s2">&quot;year_profile&quot;</span><span class="p">:</span> <span class="s2">&quot;year_vector&quot;</span><span class="p">,</span>
</span><span id="line-612">                          <span class="s2">&quot;gasses&quot;</span><span class="p">:</span> <span class="s2">&quot;gasses&quot;</span><span class="p">}</span>
</span><span id="line-613">        <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_name_mapped</span> <span class="ow">in</span> <span class="n">config_to_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-614">            <span class="k">if</span> <span class="n">input_name</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-615">                <span class="k">try</span><span class="p">:</span>
</span><span id="line-616">                    <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="n">input_name_mapped</span><span class="p">]</span>
</span><span id="line-617">                <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
</span><span id="line-618">                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Input name </span><span class="si">%s</span><span class="s2"> not found. Skipping&quot;</span><span class="p">,</span>
</span><span id="line-619">                              <span class="n">input_name_mapped</span><span class="p">)</span>
</span><span id="line-620">                <span class="n">input_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_par_to_dict</span><span class="p">(</span>
</span><span id="line-621">                    <span class="n">input_name</span><span class="o">=</span><span class="n">input_name</span><span class="p">,</span>
</span><span id="line-622">                    <span class="n">parameter</span><span class="o">=</span><span class="n">parameter_value</span><span class="p">,</span>
</span><span id="line-623">                    <span class="n">par_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span>
</span><span id="line-624">                    <span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span>
</span><span id="line-625">                    <span class="n">precision</span><span class="o">=</span><span class="n">EXCEL_NUMBER_DECIMALS</span><span class="p">)</span>
</span><span id="line-626">
</span><span id="line-627">        <span class="c1"># Add catchment inputs</span>
</span><span id="line-628">        <span class="k">if</span> <span class="s1">&#39;catchment_inputs&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-629">            <span class="c1"># Get input data</span>
</span><span id="line-630">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-631">                <span class="k">if</span> <span class="n">input_name</span> <span class="o">==</span> <span class="s1">&#39;biogenic_factors&#39;</span><span class="p">:</span>
</span><span id="line-632">                    <span class="c1"># Iterate through biogenic facors</span>
</span><span id="line-633">                    <span class="c1"># TODO: Fix this piece of code to work with the Biogenic object data</span>
</span><span id="line-634">                    <span class="c1"># Currently switched off as it produces errors</span>
</span><span id="line-635">                    <span class="k">break</span>
</span><span id="line-636">                    <span class="k">for</span> <span class="n">factor_name</span><span class="p">,</span> <span class="n">factor_value</span> <span class="ow">in</span> \
</span><span id="line-637">                            <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-638">                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">factor_name</span><span class="p">)</span>
</span><span id="line-639">                        <span class="n">input_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_par_to_dict</span><span class="p">(</span>
</span><span id="line-640">                            <span class="n">input_name</span><span class="o">=</span><span class="n">factor_name</span><span class="p">,</span>
</span><span id="line-641">                            <span class="n">parameter</span><span class="o">=</span><span class="n">factor_value</span><span class="p">,</span>
</span><span id="line-642">                            <span class="n">par_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span>
</span><span id="line-643">                            <span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span>
</span><span id="line-644">                            <span class="n">precision</span><span class="o">=</span><span class="n">EXCEL_NUMBER_DECIMALS</span><span class="p">)</span>
</span><span id="line-645">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-646">                    <span class="n">input_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_par_to_dict</span><span class="p">(</span>
</span><span id="line-647">                        <span class="n">input_name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;catch&#39;</span><span class="p">,</span> <span class="n">input_name</span><span class="p">]),</span>
</span><span id="line-648">                        <span class="n">parameter</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span>
</span><span id="line-649">                        <span class="n">par_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span>
</span><span id="line-650">                        <span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span>
</span><span id="line-651">                        <span class="n">precision</span><span class="o">=</span><span class="n">EXCEL_NUMBER_DECIMALS</span><span class="p">)</span>
</span><span id="line-652">
</span><span id="line-653">        <span class="c1"># Add reservoir inputs</span>
</span><span id="line-654">        <span class="k">if</span> <span class="s1">&#39;reservoir_inputs&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-655">            <span class="c1"># Get input data</span>
</span><span id="line-656">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-657">                <span class="n">input_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_par_to_dict</span><span class="p">(</span>
</span><span id="line-658">                    <span class="n">input_name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;res&#39;</span><span class="p">,</span> <span class="n">input_name</span><span class="p">]),</span>
</span><span id="line-659">                    <span class="n">parameter</span><span class="o">=</span><span class="n">input_value</span><span class="p">,</span>
</span><span id="line-660">                    <span class="n">par_dict</span><span class="o">=</span><span class="n">input_dict</span><span class="p">,</span>
</span><span id="line-661">                    <span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span>
</span><span id="line-662">                    <span class="n">precision</span><span class="o">=</span><span class="n">EXCEL_NUMBER_DECIMALS</span><span class="p">)</span>
</span><span id="line-663">
</span><span id="line-664">        <span class="n">reservoir_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</span><span id="line-665">        <span class="n">reservoir_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
</span><span id="line-666">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="line-667">            <span class="bp">self</span><span class="o">.</span><span class="n">input_df</span> <span class="o">=</span> <span class="n">reservoir_df</span>
</span><span id="line-668">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-669">            <span class="bp">self</span><span class="o">.</span><span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">input_df</span><span class="p">,</span> <span class="n">reservoir_df</span><span class="p">])</span></div>

</span><span id="line-670">
<div class="viewcode-block" id="ExcelWriter.dict_data_to_df">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter.dict_data_to_df">[docs]</a>
</span><span id="line-671">    <span class="k">def</span><span class="w"> </span><span class="nf">dict_data_to_df</span><span class="p">(</span>
</span><span id="line-672">            <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> 
</span><span id="line-673">            <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Name&#39;</span>
</span><span id="line-674">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="line-675"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-676"><span class="sd">        Parse data in a dictionary format into pandas DataFrame format.</span>
</span><span id="line-677">
</span><span id="line-678"><span class="sd">        Args:</span>
</span><span id="line-679"><span class="sd">            id (str): Identifier for the data (e.g., reservoir name).</span>
</span><span id="line-680"><span class="sd">            data (Dict): Dictionary containing data to be parsed into DataFrame.</span>
</span><span id="line-681"><span class="sd">            config (Dict): Configuration dictionary specifying which parameters to include.</span>
</span><span id="line-682"><span class="sd">            index_name (str, optional): Name of the index column in the DataFrame. Defaults to &#39;Name&#39;.</span>
</span><span id="line-683">
</span><span id="line-684"><span class="sd">        Returns:</span>
</span><span id="line-685"><span class="sd">            pd.DataFrame: DataFrame containing parsed data.</span>
</span><span id="line-686"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-687">        <span class="n">output</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="line-688">        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">parameter_value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-689">            <span class="c1"># Add parameter if the parameter is marked for presentation</span>
</span><span id="line-690">            <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-691">                <span class="c1"># If variable is a sequence, rollout to multiple variables</span>
</span><span id="line-692">                <span class="c1"># stored in individual columns</span>
</span><span id="line-693">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> \
</span><span id="line-694">                        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameter_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-695">                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollout</span><span class="p">(</span>
</span><span id="line-696">                            <span class="n">parameter</span><span class="p">,</span> <span class="n">parameter_value</span><span class="p">):</span>
</span><span id="line-697">                        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_parameter</span><span class="p">(</span>
</span><span id="line-698">                            <span class="n">value</span><span class="p">,</span> <span class="n">EXCEL_NUMBER_DECIMALS</span><span class="p">)}</span>
</span><span id="line-699">                        <span class="n">output</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
</span><span id="line-700">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-701">                    <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">parameter</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_parameter</span><span class="p">(</span>
</span><span id="line-702">                        <span class="n">parameter_value</span><span class="p">,</span> <span class="n">EXCEL_NUMBER_DECIMALS</span><span class="p">)}</span>
</span><span id="line-703">                    <span class="n">output</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
</span><span id="line-704">        <span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</span><span id="line-705">        <span class="n">output_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">index_name</span><span class="p">]</span>
</span><span id="line-706">        <span class="k">return</span> <span class="n">output_df</span></div>

</span><span id="line-707">    
<div class="viewcode-block" id="ExcelWriter.add_outputs">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter.add_outputs">[docs]</a>
</span><span id="line-708">    <span class="k">def</span><span class="w"> </span><span class="nf">add_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-709"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-710"><span class="sd">        Add outputs selected for presentation for a given reservoir.</span>
</span><span id="line-711">
</span><span id="line-712"><span class="sd">        Args:</span>
</span><span id="line-713"><span class="sd">            reservoir_name (str): Name of the reservoir for which outputs are to be added.</span>
</span><span id="line-714"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-715">        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span>
</span><span id="line-716">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span>
</span><span id="line-717">        <span class="n">reservoir_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_data_to_df</span><span class="p">(</span>
</span><span id="line-718">            <span class="nb">id</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
</span><span id="line-719">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="line-720">            <span class="bp">self</span><span class="o">.</span><span class="n">output_df</span> <span class="o">=</span> <span class="n">reservoir_df</span>
</span><span id="line-721">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-722">            <span class="bp">self</span><span class="o">.</span><span class="n">output_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">output_df</span><span class="p">,</span> <span class="n">reservoir_df</span><span class="p">])</span></div>

</span><span id="line-723">
<div class="viewcode-block" id="ExcelWriter.add_internals">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter.add_internals">[docs]</a>
</span><span id="line-724">    <span class="k">def</span><span class="w"> </span><span class="nf">add_internals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-725"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-726"><span class="sd">        Add internal variables selected for presentation for a given reservoir.</span>
</span><span id="line-727">
</span><span id="line-728"><span class="sd">        Args:</span>
</span><span id="line-729"><span class="sd">            reservoir_name (str): Name of the reservoir.</span>
</span><span id="line-730"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-731">        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span>
</span><span id="line-732">        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intern_vars</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span>
</span><span id="line-733">        <span class="n">reservoir_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_data_to_df</span><span class="p">(</span>
</span><span id="line-734">            <span class="nb">id</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
</span><span id="line-735">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="line-736">            <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_df</span> <span class="o">=</span> <span class="n">reservoir_df</span>
</span><span id="line-737">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-738">            <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_df</span><span class="p">,</span> <span class="n">reservoir_df</span><span class="p">])</span></div>

</span><span id="line-739">
<div class="viewcode-block" id="ExcelWriter.write">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.ExcelWriter.write">[docs]</a>
</span><span id="line-740">    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-741"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-742"><span class="sd">        Write input/output data (all reservoirs) to an Excel file.</span>
</span><span id="line-743"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-744">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="line-745">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Attempting to write before generating outputs&quot;</span><span class="p">)</span>
</span><span id="line-746">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-747">        <span class="k">for</span> <span class="n">reservoir_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="line-748">            <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-749">            <span class="bp">self</span><span class="o">.</span><span class="n">add_outputs</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-750">            <span class="bp">self</span><span class="o">.</span><span class="n">add_internals</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-751">        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
</span><span id="line-752">            <span class="bp">self</span><span class="o">.</span><span class="n">input_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-753">            <span class="bp">self</span><span class="o">.</span><span class="n">output_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;outputs&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-754">            <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;internals&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-755">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created a Excel file with outputs.&quot;</span><span class="p">)</span>
</span><span id="line-756">        <span class="k">return</span> <span class="kc">None</span></div>
</div>

</span><span id="line-757">
</span><span id="line-758">
<div class="viewcode-block" id="JSONWriter">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter">[docs]</a>
</span><span id="line-759"><span class="nd">@dataclass</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="line-760"><span class="k">class</span><span class="w"> </span><span class="nc">JSONWriter</span><span class="p">(</span><span class="n">Writer</span><span class="p">):</span>
</span><span id="line-761"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-762"><span class="sd">    Format and write data to a JSON file.</span>
</span><span id="line-763">
</span><span id="line-764"><span class="sd">    Attributes:</span>
</span><span id="line-765"><span class="sd">        inputs (Inputs): Inputs object with input data.</span>
</span><span id="line-766"><span class="sd">        outputs (Dict): Outputs dictionary.</span>
</span><span id="line-767"><span class="sd">        intern_vars (Dict): Internal variables dictionary.</span>
</span><span id="line-768"><span class="sd">        output_file_path (str): Path where the output file is to be saved/written to.</span>
</span><span id="line-769"><span class="sd">        output_config (Dict): Configuration dictionary with formatting settings for outputs.</span>
</span><span id="line-770"><span class="sd">        input_config (Dict): Configuration dictionary with formatting settings for inputs.</span>
</span><span id="line-771"><span class="sd">        intern_vars_config (Dict): Configuration dictionary with formatting settings for internal variables.</span>
</span><span id="line-772"><span class="sd">        parameter_config (Dict): Configuration file with formatting settings for parameters.</span>
</span><span id="line-773"><span class="sd">        config_ini (Dict): Global parameter configuration dict (usually from .ini file).</span>
</span><span id="line-774"><span class="sd">        author (str): Author of the document.</span>
</span><span id="line-775"><span class="sd">        title (str): Title of the document.</span>
</span><span id="line-776"><span class="sd">        json_dict (Dict): Output dictionary saved to the output JSON file. Automatically initialized.</span>
</span><span id="line-777"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-778">
</span><span id="line-779">    <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span>
</span><span id="line-780">    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-781">    <span class="n">intern_vars</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-782">    <span class="n">output_file_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-783">    <span class="n">output_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-784">    <span class="n">input_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-785">    <span class="n">intern_vars_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-786">    <span class="n">parameter_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-787">    <span class="n">config_ini</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-788">    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-789">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-790">    <span class="n">json_dict</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-791">
<div class="viewcode-block" id="JSONWriter.__post_init__">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter.__post_init__">[docs]</a>
</span><span id="line-792">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-793"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-794"><span class="sd">        Initialize json_dict which will be output as JSON.</span>
</span><span id="line-795"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-796">        <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span> <span class="o">=</span> <span class="p">{}</span></div>

</span><span id="line-797">
<div class="viewcode-block" id="JSONWriter.add_inputs">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter.add_inputs">[docs]</a>
</span><span id="line-798">    <span class="k">def</span><span class="w"> </span><span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-799"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-800"><span class="sd">        Add inputs selected for presentation for a given reservoir to json_dict.</span>
</span><span id="line-801">
</span><span id="line-802"><span class="sd">        Args:</span>
</span><span id="line-803"><span class="sd">            reservoir_name (str): Name of the reservoir.</span>
</span><span id="line-804"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-805">        <span class="n">input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</span><span id="line-806">        <span class="n">input_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="line-807">        <span class="c1"># Find out which inputs to include in the presentation</span>
</span><span id="line-808">        <span class="n">included_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-809">        <span class="k">for</span> <span class="n">input_name</span> <span class="ow">in</span> <span class="n">INPUT_NAMES</span><span class="p">:</span>
</span><span id="line-810">            <span class="n">input_data_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-811">            <span class="k">if</span> <span class="n">input_data_conf</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-812">                <span class="n">included_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>
</span><span id="line-813">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">included_inputs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="line-814">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-815">        <span class="c1"># Mapping between input names and input names in the Input.data dict.</span>
</span><span id="line-816">        <span class="n">config_to_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="s2">&quot;coordinates&quot;</span><span class="p">,</span>
</span><span id="line-817">                          <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span>
</span><span id="line-818">                          <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
</span><span id="line-819">                          <span class="s2">&quot;monthly_temps&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_temps&quot;</span><span class="p">,</span>
</span><span id="line-820">                          <span class="s2">&quot;year_profile&quot;</span><span class="p">:</span> <span class="s2">&quot;year_vector&quot;</span><span class="p">,</span>
</span><span id="line-821">                          <span class="s2">&quot;gasses&quot;</span><span class="p">:</span> <span class="s2">&quot;gasses&quot;</span><span class="p">}</span>
</span><span id="line-822">        <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_name_mapped</span> <span class="ow">in</span> <span class="n">config_to_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-823">            <span class="k">if</span> <span class="n">input_name</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-824">                <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-825">                <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-826">                <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
</span><span id="line-827">                <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="n">input_name_mapped</span><span class="p">]</span>
</span><span id="line-828">                <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
</span><span id="line-829">        <span class="c1"># Add biogenic factors</span>
</span><span id="line-830">        <span class="k">if</span> <span class="s1">&#39;biogenic_factors&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-831">            <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-832">            <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;biogenic_factors&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-833">            <span class="c1"># Check if biogenic factors are of BiogenicFactors type</span>
</span><span id="line-834">            <span class="c1"># instead of a dictionary - the data is a dictionary in</span>
</span><span id="line-835">            <span class="c1"># text input files but then is converted to BiogenicFactors</span>
</span><span id="line-836">            <span class="c1"># type</span>
</span><span id="line-837">            <span class="n">biogenic_factors</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">][</span><span class="s1">&#39;biogenic_factors&#39;</span><span class="p">]</span>
</span><span id="line-838">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">biogenic_factors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="line-839">                <span class="k">try</span><span class="p">:</span>
</span><span id="line-840">                    <span class="n">biogenic_factors</span> <span class="o">=</span> <span class="n">biogenic_factors</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
</span><span id="line-841">                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="line-842">                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Variable biogenic factors cannot be &#39;</span> <span class="o">+</span>
</span><span id="line-843">                              <span class="s1">&#39;converted to a dictionary&#39;</span><span class="p">)</span>
</span><span id="line-844">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">biogenic_factors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-845">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-846">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FACTOR_NAMES</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-847">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="line-848">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_value</span>
</span><span id="line-849">            <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">][</span><span class="s1">&#39;biogenic_factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
</span><span id="line-850">        <span class="c1"># Add catchment inputs</span>
</span><span id="line-851">        <span class="k">if</span> <span class="s1">&#39;catchment_inputs&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-852">            <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-853">            <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;catchment_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-854">            <span class="c1"># Get input data</span>
</span><span id="line-855">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-856">                <span class="k">if</span> <span class="n">input_name</span> <span class="o">==</span> <span class="s1">&#39;biogenic_factors&#39;</span><span class="p">:</span>
</span><span id="line-857">                    <span class="k">break</span>
</span><span id="line-858">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-859">                <span class="c1"># Get input name and unit from config</span>
</span><span id="line-860">                <span class="n">conf_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span>
</span><span id="line-861">                    <span class="s1">&#39;catchment_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;var_dict&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-862">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-863">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
</span><span id="line-864">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> \
</span><span id="line-865">                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-866">                    <span class="n">input_value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-867">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_value</span>
</span><span id="line-868">            <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">][</span><span class="s1">&#39;catchment_inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
</span><span id="line-869">        <span class="c1"># Add reservoir inputs</span>
</span><span id="line-870">        <span class="k">if</span> <span class="s1">&#39;reservoir_inputs&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-871">            <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-872">            <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-873">            <span class="c1"># Get input data</span>
</span><span id="line-874">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-875">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-876">                <span class="c1"># Get input name and unit from config</span>
</span><span id="line-877">                <span class="n">conf_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span>
</span><span id="line-878">                    <span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;var_dict&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-879">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-880">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
</span><span id="line-881">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> \
</span><span id="line-882">                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-883">                    <span class="n">input_value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-884">                <span class="n">param_dict</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_value</span>
</span><span id="line-885">            <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">][</span><span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_dict</span>
</span><span id="line-886">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-887">            <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>
</span><span id="line-888">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-889">            <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_dict</span></div>

</span><span id="line-890">
<div class="viewcode-block" id="JSONWriter.parse_dict_data">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter.parse_dict_data">[docs]</a>
</span><span id="line-891">    <span class="k">def</span><span class="w"> </span><span class="nf">parse_dict_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">item_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="line-892"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-893"><span class="sd">        Parse data dictionary into a structured format based on configuration.</span>
</span><span id="line-894">
</span><span id="line-895"><span class="sd">        Args:</span>
</span><span id="line-896"><span class="sd">            config (Dict): Configuration dictionary indicating which parameters to include.</span>
</span><span id="line-897"><span class="sd">            data (Dict): Dictionary containing data to be parsed.</span>
</span><span id="line-898"><span class="sd">            item_names (Tuple): Tuple of item names to include in the parsed output.</span>
</span><span id="line-899">
</span><span id="line-900"><span class="sd">        Returns:</span>
</span><span id="line-901"><span class="sd">            Dict: Parsed dictionary data.</span>
</span><span id="line-902"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-903">        <span class="n">output_dict</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="line-904">        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">parameter_value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-905">            <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-906">                <span class="n">param_dict</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">parameter</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="line-907">                <span class="k">for</span> <span class="n">item_name</span> <span class="ow">in</span> <span class="n">item_names</span><span class="p">:</span>
</span><span id="line-908">                    <span class="n">item</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item_name</span><span class="p">)</span>
</span><span id="line-909">                    <span class="n">param_dict</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="n">item_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
</span><span id="line-910">                <span class="n">param_dict</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_parameter</span><span class="p">(</span>
</span><span id="line-911">                    <span class="n">parameter_value</span><span class="p">,</span> <span class="n">JSON_NUMBER_DECIMALS</span><span class="p">)</span>
</span><span id="line-912">                <span class="n">output_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
</span><span id="line-913">        <span class="k">return</span> <span class="n">output_dict</span></div>

</span><span id="line-914">            
<div class="viewcode-block" id="JSONWriter.add_outputs">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter.add_outputs">[docs]</a>
</span><span id="line-915">    <span class="k">def</span><span class="w"> </span><span class="nf">add_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-916"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-917"><span class="sd">        Add outputs selected for presentation for a given reservoir to `json_dict`.</span>
</span><span id="line-918">
</span><span id="line-919"><span class="sd">        Args:</span>
</span><span id="line-920"><span class="sd">            reservoir_name (str): Name of the reservoir.</span>
</span><span id="line-921"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-922">        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">]</span>
</span><span id="line-923">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span>
</span><span id="line-924">        <span class="n">parsed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_dict_data</span><span class="p">(</span>
</span><span id="line-925">            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span id="line-926">            <span class="n">item_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;gas_name&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;long_description&#39;</span><span class="p">))</span>
</span><span id="line-927">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-928">            <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">})</span>
</span><span id="line-929">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-930">            <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;outputs&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">}</span></div>

</span><span id="line-931">
<div class="viewcode-block" id="JSONWriter.add_internals">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter.add_internals">[docs]</a>
</span><span id="line-932">    <span class="k">def</span><span class="w"> </span><span class="nf">add_internals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-933"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-934"><span class="sd">        Add internal variables selected for presentation for a given reservoir to `json_dict`.</span>
</span><span id="line-935">
</span><span id="line-936"><span class="sd">        Args:</span>
</span><span id="line-937"><span class="sd">            reservoir_name (str): Name of the reservoir.</span>
</span><span id="line-938"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-939">        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span>
</span><span id="line-940">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span>
</span><span id="line-941">        <span class="n">parsed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_dict_data</span><span class="p">(</span>
</span><span id="line-942">            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span id="line-943">            <span class="n">item_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;long_description&#39;</span><span class="p">))</span>
</span><span id="line-944">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-945">            <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;intern_vars&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">})</span>
</span><span id="line-946">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-947">            <span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;intern_vars&#39;</span><span class="p">:</span> <span class="n">parsed_data</span><span class="p">}</span></div>

</span><span id="line-948">
<div class="viewcode-block" id="JSONWriter.write">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.JSONWriter.write">[docs]</a>
</span><span id="line-949">    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-950"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-951"><span class="sd">        Write output data (all reservoirs) to a JSON file.</span>
</span><span id="line-952"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-953">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="line-954">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Attempting to write before generating outputs.&quot;</span><span class="p">)</span>
</span><span id="line-955">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-956">        <span class="k">for</span> <span class="n">reservoir_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="line-957">            <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-958">            <span class="bp">self</span><span class="o">.</span><span class="n">add_outputs</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-959">            <span class="bp">self</span><span class="o">.</span><span class="n">add_internals</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-960">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">,</span>
</span><span id="line-961">                  <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_pointer</span><span class="p">:</span>
</span><span id="line-962">            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">json_dict</span><span class="p">,</span> <span class="n">file_pointer</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="line-963">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created a json file with outputs.&quot;</span><span class="p">)</span>
</span><span id="line-964">        <span class="k">return</span> <span class="kc">None</span></div>
</div>

</span><span id="line-965">
</span><span id="line-966">
<div class="viewcode-block" id="LatexWriter">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter">[docs]</a>
</span><span id="line-967"><span class="nd">@dataclass</span>  <span class="c1"># type: ignore[misc]</span>
</span><span id="line-968"><span class="k">class</span><span class="w"> </span><span class="nc">LatexWriter</span><span class="p">(</span><span class="n">Writer</span><span class="p">):</span>
</span><span id="line-969"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and write data to a LaTeX file using PyLaTeX.</span>
</span><span id="line-970">
</span><span id="line-971"><span class="sd">    Attributes:</span>
</span><span id="line-972"><span class="sd">        inputs (Inputs): Inputs object with input data.</span>
</span><span id="line-973"><span class="sd">        outputs (Dict): Outputs dictionary.</span>
</span><span id="line-974"><span class="sd">        intern_vars (Dict): Internal variables dictionary.</span>
</span><span id="line-975"><span class="sd">        output_file_path (str): Path where the output file is to be saved/written to.</span>
</span><span id="line-976"><span class="sd">        output_config (Dict): Configuration file with formatting settings.</span>
</span><span id="line-977"><span class="sd">        input_config (Dict): Configuration file with formatting settings.</span>
</span><span id="line-978"><span class="sd">        intern_vars_config (Dict): Configuration dictionary with formatting settings.</span>
</span><span id="line-979"><span class="sd">        parameter_config (Dict): Configuration file with formatting settings.</span>
</span><span id="line-980"><span class="sd">        config_ini (Dict): Global parameter configuration dict (usually from .ini file).</span>
</span><span id="line-981"><span class="sd">        author (str): Author of the document.</span>
</span><span id="line-982"><span class="sd">        title (str): Title of the document.</span>
</span><span id="line-983"><span class="sd">        document (Document): PyLaTeX Document object.</span>
</span><span id="line-984"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-985">
</span><span id="line-986">    <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span>
</span><span id="line-987">    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-988">    <span class="n">intern_vars</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-989">    <span class="n">output_file_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-990">    <span class="n">output_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-991">    <span class="n">input_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-992">    <span class="n">intern_vars_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-993">    <span class="n">parameter_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-994">    <span class="n">config_ini</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-995">    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-996">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-997">
<div class="viewcode-block" id="LatexWriter.__post_init__">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.__post_init__">[docs]</a>
</span><span id="line-998">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-999"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the PyLaTeX document with specified geometry.&quot;&quot;&quot;</span>
</span><span id="line-1000">        <span class="n">path_no_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="line-1001">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">path_no_ext</span><span class="p">,</span> <span class="n">geometry_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">())</span></div>

</span><span id="line-1002">
<div class="viewcode-block" id="LatexWriter.geometry">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.geometry">[docs]</a>
</span><span id="line-1003">    <span class="nd">@staticmethod</span>
</span><span id="line-1004">    <span class="k">def</span><span class="w"> </span><span class="nf">geometry</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="line-1005"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create document geometry structure.</span>
</span><span id="line-1006">
</span><span id="line-1007"><span class="sd">        Returns:</span>
</span><span id="line-1008"><span class="sd">            Dict: Dictionary containing the document geometry options.</span>
</span><span id="line-1009"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1010">        <span class="n">document_geometry</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-1011">            <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0in&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">:</span> <span class="s2">&quot;0.75in&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="s2">&quot;0.55in&quot;</span><span class="p">,</span>
</span><span id="line-1012">            <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="s2">&quot;0.55in&quot;</span><span class="p">,</span> <span class="s2">&quot;includeheadfoot&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</span><span id="line-1013">        <span class="k">return</span> <span class="n">document_geometry</span></div>

</span><span id="line-1014">
<div class="viewcode-block" id="LatexWriter.plot_profile">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.plot_profile">[docs]</a>
</span><span id="line-1015">    <span class="k">def</span><span class="w"> </span><span class="nf">plot_profile</span><span class="p">(</span>
</span><span id="line-1016">            <span class="bp">self</span><span class="p">,</span> 
</span><span id="line-1017">            <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> 
</span><span id="line-1018">            <span class="n">emission</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="line-1019">            <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-1020">            <span class="n">annotate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1021"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot an emission profile using matplotlib.</span>
</span><span id="line-1022">
</span><span id="line-1023"><span class="sd">        Args:</span>
</span><span id="line-1024"><span class="sd">            axis (plt.Axes): Matplotlib axes object.</span>
</span><span id="line-1025"><span class="sd">            emission (str): Name of the gas/emission to plot.</span>
</span><span id="line-1026"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1027"><span class="sd">            annotate (bool): Flag setting whether emission values are added to plot. Default is True.</span>
</span><span id="line-1028"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1029">        <span class="n">emission_var</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-1030">            <span class="s2">&quot;co2&quot;</span><span class="p">:</span> <span class="s2">&quot;co2_profile&quot;</span><span class="p">,</span>
</span><span id="line-1031">            <span class="s2">&quot;ch4&quot;</span><span class="p">:</span> <span class="s2">&quot;ch4_profile&quot;</span><span class="p">,</span>
</span><span id="line-1032">            <span class="s2">&quot;n2o&quot;</span><span class="p">:</span> <span class="s2">&quot;n2o_profile&quot;</span><span class="p">}</span>       
</span><span id="line-1033">        <span class="n">emission_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span>
</span><span id="line-1034">            <span class="n">emission_var</span><span class="p">[</span><span class="n">emission</span><span class="p">]][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">]</span>
</span><span id="line-1035">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1036">        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span>
</span><span id="line-1037">            <span class="n">emission_var</span><span class="p">[</span><span class="n">emission</span><span class="p">]][</span><span class="s1">&#39;name_latex&#39;</span><span class="p">],</span> <span class="n">output_name</span><span class="p">))</span>
</span><span id="line-1038">        <span class="c1"># Create title and y_label</span>
</span><span id="line-1039">        <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Emission, &quot;</span> <span class="o">+</span> <span class="n">emission_unit</span>
</span><span id="line-1040">        <span class="c1"># Get the x and y data</span>
</span><span id="line-1041">        <span class="k">try</span><span class="p">:</span>
</span><span id="line-1042">            <span class="n">y_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">emission_var</span><span class="p">[</span><span class="n">emission</span><span class="p">]]</span>
</span><span id="line-1043">            <span class="n">x_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;year_vector&quot;</span><span class="p">]</span>
</span><span id="line-1044">        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-1045">            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="line-1046">                <span class="s2">&quot;Problem with plotting emission profiles: X or Y data for emission profiles not found.&quot;</span><span class="p">)</span>
</span><span id="line-1047">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-1048">        <span class="n">emission_profile</span><span class="p">(</span>
</span><span id="line-1049">            <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="n">x_data</span><span class="p">,</span> <span class="n">emissions</span><span class="o">=</span><span class="n">y_data</span><span class="p">,</span>
</span><span id="line-1050">            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">)</span></div>

</span><span id="line-1051">
<div class="viewcode-block" id="LatexWriter.plot_emission_bars">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.plot_emission_bars">[docs]</a>
</span><span id="line-1052">    <span class="k">def</span><span class="w"> </span><span class="nf">plot_emission_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1053"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize total emissions (unit x surface area) for the calculated gases.</span>
</span><span id="line-1054">
</span><span id="line-1055"><span class="sd">        Args:</span>
</span><span id="line-1056"><span class="sd">            axis (plt.Axes): Matplotlib axes object.</span>
</span><span id="line-1057"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1058"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1059">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1060">        <span class="n">vars_to_plot</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;co2_net&#39;</span><span class="p">,</span> <span class="s1">&#39;ch4_net&#39;</span><span class="p">,</span> <span class="s1">&#39;n2o_mean&#39;</span><span class="p">)</span>
</span><span id="line-1061">        <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;gas_name_latex&#39;</span><span class="p">]</span> <span class="k">for</span>
</span><span id="line-1062">                <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_to_plot</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="line-1063">        <span class="c1"># Get reservoir area from inputs (convert from km2 to m2)</span>
</span><span id="line-1064">        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">][</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="line-1065">            <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
</span><span id="line-1066">        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_to_plot</span>
</span><span id="line-1067">                  <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="line-1068">        <span class="n">emission_bars</span><span class="p">(</span>
</span><span id="line-1069">            <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">gases</span><span class="o">=</span><span class="n">bars</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
</span><span id="line-1070">            <span class="n">output_name</span><span class="o">=</span><span class="n">output_name</span><span class="p">)</span></div>

</span><span id="line-1071">
</span><span id="line-1072">
<div class="viewcode-block" id="LatexWriter.plot_landcover_piecharts">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.plot_landcover_piecharts">[docs]</a>
</span><span id="line-1073">    <span class="k">def</span><span class="w"> </span><span class="nf">plot_landcover_piecharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1074"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot pie charts of landcover compositions for reservoir and catchment.</span>
</span><span id="line-1075">
</span><span id="line-1076"><span class="sd">        Args:</span>
</span><span id="line-1077"><span class="sd">            axes (np.ndarray): Array of matplotlib axes objects.</span>
</span><span id="line-1078"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1079"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1080">        <span class="c1">#data = self.inputs.data[output_name]</span>
</span><span id="line-1081">        <span class="n">input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1082">        <span class="n">landcovers_reservoir</span> <span class="o">=</span> <span class="n">parse_landcover_composition</span><span class="p">(</span>
</span><span id="line-1083">            <span class="n">input_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">][</span><span class="s1">&#39;area_fractions&#39;</span><span class="p">])</span>
</span><span id="line-1084">        <span class="n">landcovers_catchment</span> <span class="o">=</span> <span class="n">parse_landcover_composition</span><span class="p">(</span>
</span><span id="line-1085">            <span class="n">input_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">][</span><span class="s1">&#39;area_fractions&#39;</span><span class="p">])</span>
</span><span id="line-1086">        <span class="c1"># Make sure that the sums are equal to one (they should be because of earlier steps)</span>
</span><span id="line-1087">        <span class="c1"># But just for the piece of mind, make an additional check</span>
</span><span id="line-1088">        <span class="n">landcovers_reservoir</span> <span class="o">=</span> <span class="n">enforce_unity_sum</span><span class="p">(</span><span class="n">landcovers_reservoir</span><span class="p">)</span>
</span><span id="line-1089">        <span class="n">landcovers_catchment</span> <span class="o">=</span> <span class="n">enforce_unity_sum</span><span class="p">(</span><span class="n">landcovers_catchment</span><span class="p">)</span>
</span><span id="line-1090">        <span class="n">landcover_pie</span><span class="p">(</span>
</span><span id="line-1091">            <span class="n">axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">landcovers_reservoir</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">landcover_names</span><span class="p">,</span>
</span><span id="line-1092">            <span class="n">colors</span><span class="o">=</span><span class="n">landcover_colors</span><span class="p">,</span> 
</span><span id="line-1093">            <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Reservoir</span><span class="se">\n</span><span class="s2">Landcover Composition&quot;</span><span class="p">)</span>
</span><span id="line-1094">        <span class="n">landcover_pie</span><span class="p">(</span>
</span><span id="line-1095">            <span class="n">axis</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">landcovers_catchment</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">landcover_names</span><span class="p">,</span>
</span><span id="line-1096">            <span class="n">colors</span><span class="o">=</span><span class="n">landcover_colors</span><span class="p">,</span> 
</span><span id="line-1097">            <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Catchment</span><span class="se">\n</span><span class="s2">Landcover Composition&quot;</span><span class="p">)</span></div>

</span><span id="line-1098">
</span><span id="line-1099">
<div class="viewcode-block" id="LatexWriter.add_plots">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_plots">[docs]</a>
</span><span id="line-1100">    <span class="k">def</span><span class="w"> </span><span class="nf">add_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plot_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="line-1101">                  <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1102"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate and add emission plots to the document.</span>
</span><span id="line-1103">
</span><span id="line-1104"><span class="sd">        Args:</span>
</span><span id="line-1105"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1106"><span class="sd">            plot_fraction (float): Fraction of text width the plot takes on the page. Default is 0.75.</span>
</span><span id="line-1107"><span class="sd">            dpi (int): Resolution of the created figure within PDF. Default is 300.</span>
</span><span id="line-1108"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1109">        <span class="n">profile_plots</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;plot_profiles&#39;</span><span class="p">])</span>
</span><span id="line-1110">        <span class="n">bar_plot</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;plot_emission_bars&#39;</span><span class="p">])</span>
</span><span id="line-1111">        <span class="c1"># Find out how many subplots to define</span>
</span><span id="line-1112">        <span class="n">no_plots</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="line-1113">        <span class="k">if</span> <span class="n">profile_plots</span><span class="p">:</span>
</span><span id="line-1114">            <span class="c1"># Find a number of gases that are computed (for the</span>
</span><span id="line-1115">            <span class="c1"># specified output name)</span>
</span><span id="line-1116">            <span class="n">no_plots</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gasses&#39;</span><span class="p">])</span>
</span><span id="line-1117">        <span class="k">if</span> <span class="n">bar_plot</span><span class="p">:</span>
</span><span id="line-1118">            <span class="n">no_plots</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="line-1119">        <span class="k">if</span> <span class="n">no_plots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="line-1120">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-1121">        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="line-1122">        <span class="k">if</span> <span class="n">no_plots</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="line-1123">            <span class="n">subplot_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-1124">        <span class="k">elif</span> <span class="n">no_plots</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="line-1125">            <span class="n">subplot_dim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-1126">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s1">&#39;Emission plots&#39;</span><span class="p">)):</span>
</span><span id="line-1127">            <span class="n">fig_index</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="line-1128">            <span class="k">if</span> <span class="n">profile_plots</span><span class="p">:</span>
</span><span id="line-1129">                <span class="k">for</span> <span class="n">gas</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;co2&#39;</span><span class="p">,</span> <span class="s1">&#39;ch4&#39;</span><span class="p">,</span> <span class="s1">&#39;n2o&#39;</span><span class="p">]:</span>
</span><span id="line-1130">                    <span class="k">if</span> <span class="n">gas</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;gasses&#39;</span><span class="p">]:</span>
</span><span id="line-1131">                        <span class="k">continue</span>
</span><span id="line-1132">                    <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subplot_dim</span><span class="p">,</span> <span class="n">fig_index</span><span class="p">)</span>
</span><span id="line-1133">                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_profile</span><span class="p">(</span>
</span><span id="line-1134">                        <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">emission</span><span class="o">=</span><span class="n">gas</span><span class="p">,</span> <span class="n">output_name</span><span class="o">=</span><span class="n">output_name</span><span class="p">,</span>
</span><span id="line-1135">                        <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-1136">                    <span class="n">fig_index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="line-1137">            <span class="k">if</span> <span class="n">bar_plot</span><span class="p">:</span>
</span><span id="line-1138">                <span class="n">axis</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subplot_dim</span><span class="p">,</span> <span class="n">fig_index</span><span class="p">)</span>
</span><span id="line-1139">                <span class="bp">self</span><span class="o">.</span><span class="n">plot_emission_bars</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">output_name</span><span class="o">=</span><span class="n">output_name</span><span class="p">)</span>
</span><span id="line-1140">
</span><span id="line-1141">            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="line-1142">            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Figure</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s1">&#39;htbp&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="line-1143">                <span class="n">width</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">\textwidth&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_fraction</span><span class="p">)</span>
</span><span id="line-1144">                <span class="n">plot</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">NoEscape</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
</span><span id="line-1145">        <span class="c1"># TODO: There&#39;s an intermittent error with profiles not being plotted and only</span>
</span><span id="line-1146">        <span class="c1"># bar plot appearing in the report. Could be sth. to do with overwriting axes</span>
</span><span id="line-1147">        <span class="c1"># as profile plot is added with add_subplot method. </span>
</span><span id="line-1148">        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="line-1149">        <span class="k">return</span> <span class="kc">None</span></div>

</span><span id="line-1150">        
<div class="viewcode-block" id="LatexWriter.add_landcover_charts">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_landcover_charts">[docs]</a>
</span><span id="line-1151">    <span class="k">def</span><span class="w"> </span><span class="nf">add_landcover_charts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plot_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
</span><span id="line-1152">                  <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1153"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add pie charts with landcover proportions for reservoir and catchment.</span>
</span><span id="line-1154">
</span><span id="line-1155"><span class="sd">        Args:</span>
</span><span id="line-1156"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1157"><span class="sd">            plot_fraction (float): Fraction of text width the plot takes on the page. Default is 0.95.</span>
</span><span id="line-1158"><span class="sd">            dpi (int): Resolution of the created figure within PDF. Default is 300.</span>
</span><span id="line-1159"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1160">        <span class="n">plot_piecharts</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;plot_landcover_piecharts&#39;</span><span class="p">])</span>
</span><span id="line-1161">        <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_piecharts</span><span class="p">:</span> <span class="c1"># Playing the non-indent guy.</span>
</span><span id="line-1162">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-1163">        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-1164">        <span class="bp">self</span><span class="o">.</span><span class="n">plot_landcover_piecharts</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">output_name</span><span class="o">=</span><span class="n">output_name</span><span class="p">)</span>
</span><span id="line-1165">        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="line-1166">        <span class="c1">#with self.document.create(Subsection(&#39;Landcover composition plots&#39;)):</span>
</span><span id="line-1167">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Figure</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">plot</span><span class="p">:</span>
</span><span id="line-1168">            <span class="n">width</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">\textwidth&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">plot_fraction</span><span class="p">)</span>
</span><span id="line-1169">            <span class="n">plot</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">NoEscape</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
</span><span id="line-1170">        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="line-1171">        <span class="k">return</span> <span class="kc">None</span></div>

</span><span id="line-1172">        
<div class="viewcode-block" id="LatexWriter.add_parameters">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_parameters">[docs]</a>
</span><span id="line-1173">    <span class="k">def</span><span class="w"> </span><span class="nf">add_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1174"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add information about model parameters such as conversion factors</span>
</span><span id="line-1175"><span class="sd">        and other useful details to the report.</span>
</span><span id="line-1176">
</span><span id="line-1177"><span class="sd">        Args:</span>
</span><span id="line-1178"><span class="sd">            precision (int): Number of decimal points in output parameters. Default is 4.</span>
</span><span id="line-1179"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1180">        <span class="n">round_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;round-precision&#39;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
</span><span id="line-1181">                         <span class="s1">&#39;round-mode&#39;</span><span class="p">:</span> <span class="s1">&#39;figures&#39;</span><span class="p">}</span>
</span><span id="line-1182">        <span class="c1"># TODO: Currently only supports two parameters</span>
</span><span id="line-1183">        <span class="c1">#       If we would like to output more/all parameters, this will have</span>
</span><span id="line-1184">        <span class="c1">#       to be made more generic. Potentially .ini file could be</span>
</span><span id="line-1185">        <span class="c1">#       translated into yaml</span>
</span><span id="line-1186">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_config</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;gwp100&#39;</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-1187">            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span id="line-1188">                    <span class="n">Subsection</span><span class="p">(</span>
</span><span id="line-1189">                        <span class="s1">&#39;Global Warming Potentials (GWPs) over 100 years&#39;</span><span class="p">)):</span>
</span><span id="line-1190">                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Description</span><span class="p">())</span> <span class="k">as</span> <span class="n">desc</span><span class="p">:</span>
</span><span id="line-1191">                    <span class="k">try</span><span class="p">:</span>
</span><span id="line-1192">                        <span class="n">desc</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
</span><span id="line-1193">                            <span class="n">NoEscape</span><span class="p">(</span><span class="s2">&quot;GWP100 for CO$_2$: &quot;</span><span class="p">),</span>
</span><span id="line-1194">                            <span class="n">safe_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">[</span><span class="s1">&#39;CARBON_DIOXIDE&#39;</span><span class="p">][</span><span class="s1">&#39;co2_gwp100&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">))</span>
</span><span id="line-1195">                        <span class="n">desc</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
</span><span id="line-1196">                            <span class="n">NoEscape</span><span class="p">(</span><span class="s2">&quot;GWP100 for CH$_4$: &quot;</span><span class="p">),</span>
</span><span id="line-1197">                            <span class="n">safe_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">[</span><span class="s1">&#39;METHANE&#39;</span><span class="p">][</span><span class="s1">&#39;ch4_gwp100&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">))</span>
</span><span id="line-1198">                        <span class="n">desc</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
</span><span id="line-1199">                            <span class="n">NoEscape</span><span class="p">(</span><span class="s2">&quot;GWP100 for N$_2$O: &quot;</span><span class="p">),</span>
</span><span id="line-1200">                            <span class="n">safe_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">[</span><span class="s1">&#39;NITROUS_OXIDE&#39;</span><span class="p">][</span><span class="s1">&#39;nitrous_gwp100&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">))</span>
</span><span id="line-1201">                    <span class="k">except</span> <span class="n">configparser</span><span class="o">.</span><span class="n">NoSectionError</span><span class="p">:</span>
</span><span id="line-1202">                        <span class="k">pass</span>
</span><span id="line-1203">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_config</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;conv_factors&#39;</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-1204">            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Unit conversion factors&quot;</span><span class="p">)):</span>
</span><span id="line-1205">                <span class="k">try</span><span class="p">:</span>
</span><span id="line-1206">                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Description</span><span class="p">())</span> <span class="k">as</span> <span class="n">desc</span><span class="p">:</span>
</span><span id="line-1207">                        <span class="n">conv_coeff</span> <span class="o">=</span> <span class="n">safe_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">[</span><span class="s1">&#39;CARBON_DIOXIDE&#39;</span><span class="p">][</span><span class="s1">&#39;conv_coeff&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="line-1208">                        <span class="n">desc</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
</span><span id="line-1209">                            <span class="n">NoEscape</span><span class="p">(</span><span class="s1">&#39;Conversion from mg~CO$_2$-C~m$^{-2}$~&#39;</span> <span class="o">+</span>
</span><span id="line-1210">                                     <span class="s1">&#39;d$^{-1}$ to g~CO$_{2,eq}$~m$^{-2}$~&#39;</span> <span class="o">+</span>
</span><span id="line-1211">                                     <span class="s1">&#39;yr$^{-1}$: &#39;</span><span class="p">),</span>
</span><span id="line-1212">                            <span class="n">Quantity</span><span class="p">(</span><span class="n">conv_coeff</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">),</span>
</span><span id="line-1213">                        <span class="p">)</span>
</span><span id="line-1214">                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Description</span><span class="p">())</span> <span class="k">as</span> <span class="n">desc</span><span class="p">:</span>
</span><span id="line-1215">                        <span class="n">conv_coeff</span> <span class="o">=</span> <span class="n">safe_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">[</span><span class="s1">&#39;METHANE&#39;</span><span class="p">][</span><span class="s1">&#39;conv_coeff&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="line-1216">                        <span class="n">desc</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
</span><span id="line-1217">                            <span class="n">NoEscape</span><span class="p">(</span><span class="s1">&#39;Conversion from mg CH$_4$~m$^{-2}$~&#39;</span> <span class="o">+</span>
</span><span id="line-1218">                                     <span class="s1">&#39;d$^{-1}$ to g~CO$_{2,eq}$~m$^{-2}$~&#39;</span> <span class="o">+</span>
</span><span id="line-1219">                                     <span class="s1">&#39;yr$^{-1}$: &#39;</span><span class="p">),</span>
</span><span id="line-1220">                            <span class="n">Quantity</span><span class="p">(</span><span class="n">conv_coeff</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">),</span>
</span><span id="line-1221">                        <span class="p">)</span>
</span><span id="line-1222">                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Description</span><span class="p">())</span> <span class="k">as</span> <span class="n">desc</span><span class="p">:</span>
</span><span id="line-1223">                        <span class="n">conv_coeff</span> <span class="o">=</span> <span class="n">safe_cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">[</span><span class="s1">&#39;NITROUS_OXIDE&#39;</span><span class="p">][</span><span class="s1">&#39;conv_coeff&#39;</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="line-1224">                        <span class="n">desc</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span>
</span><span id="line-1225">                            <span class="n">NoEscape</span><span class="p">(</span><span class="s1">&#39;Conversion from $</span><span class="se">\\</span><span class="s1">mu$g~N$_2$O~&#39;</span> <span class="o">+</span>
</span><span id="line-1226">                                     <span class="s1">&#39;m$^{-2}$~d$^{-1}$ to g~CO$_{2,eq}$~&#39;</span> <span class="o">+</span>
</span><span id="line-1227">                                     <span class="s1">&#39;m$^{-2}$~yr$^{-1}$: &#39;</span><span class="p">),</span>
</span><span id="line-1228">                            <span class="n">Quantity</span><span class="p">(</span><span class="n">conv_coeff</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">),</span>
</span><span id="line-1229">                        <span class="p">)</span>
</span><span id="line-1230">                <span class="k">except</span> <span class="n">configparser</span><span class="o">.</span><span class="n">NoSectionError</span><span class="p">:</span>
</span><span id="line-1231">                    <span class="k">pass</span></div>

</span><span id="line-1232">
<div class="viewcode-block" id="LatexWriter.add_intern_vars_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_intern_vars_table">[docs]</a>
</span><span id="line-1233">    <span class="k">def</span><span class="w"> </span><span class="nf">add_intern_vars_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1234"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds internal variables table to the LaTeX document.</span>
</span><span id="line-1235">
</span><span id="line-1236"><span class="sd">        Args:</span>
</span><span id="line-1237"><span class="sd">            output_name (str): Name of the internal variable/reservoir.</span>
</span><span id="line-1238"><span class="sd">            precision (int): Number of decimal points in the output values.</span>
</span><span id="line-1239"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1240">        <span class="n">round_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;round-precision&#39;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
</span><span id="line-1241">                         <span class="s1">&#39;round-mode&#39;</span><span class="p">:</span> <span class="s1">&#39;figures&#39;</span><span class="p">}</span>
</span><span id="line-1242">        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">]</span>
</span><span id="line-1243">        <span class="n">table_format</span> <span class="o">=</span> <span class="s2">&quot;p</span><span class="si">{10cm}</span><span class="s2"> X[c] X[l]&quot;</span>
</span><span id="line-1244">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1245">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Center</span><span class="p">())</span> <span class="k">as</span> <span class="n">centered</span><span class="p">:</span>
</span><span id="line-1246">            <span class="k">with</span> <span class="n">centered</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Tabu</span><span class="p">(</span><span class="n">table_format</span><span class="p">,</span> <span class="n">booktabs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="line-1247">                                      <span class="n">row_height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span> <span class="k">as</span> <span class="n">data_table</span><span class="p">:</span>
</span><span id="line-1248">                <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="p">[</span><span class="n">bold</span><span class="p">])</span>
</span><span id="line-1249">                <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1250">                <span class="c1"># Iterate through outputs and generate rows of data to be</span>
</span><span id="line-1251">                <span class="c1"># entered into the table</span>
</span><span id="line-1252">                <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1253">                    <span class="n">parameter_name</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1254">                        <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;name_latex&#39;</span><span class="p">])</span>
</span><span id="line-1255">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1256">                        <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1257">                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
</span><span id="line-1258">                        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="line-1259">                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]</span> \
</span><span id="line-1260">                            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="line-1261">                        <span class="c1"># Lists describe profiles and should not be put in the</span>
</span><span id="line-1262">                        <span class="c1"># table</span>
</span><span id="line-1263">                        <span class="n">value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">)</span>
</span><span id="line-1264">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">parameter_name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>
</span><span id="line-1265">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span></div>

</span><span id="line-1266">
<div class="viewcode-block" id="LatexWriter.add_outputs_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_outputs_table">[docs]</a>
</span><span id="line-1267">    <span class="k">def</span><span class="w"> </span><span class="nf">add_outputs_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1268"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds outputs table to the LaTeX document.</span>
</span><span id="line-1269">
</span><span id="line-1270"><span class="sd">        Args:</span>
</span><span id="line-1271"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1272"><span class="sd">            precision (int): Number of decimal points in the output values.</span>
</span><span id="line-1273"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1274">        <span class="n">round_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;round-precision&#39;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
</span><span id="line-1275">                         <span class="s1">&#39;round-mode&#39;</span><span class="p">:</span> <span class="s1">&#39;figures&#39;</span><span class="p">}</span>
</span><span id="line-1276">        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">]</span>
</span><span id="line-1277">        <span class="n">table_format</span> <span class="o">=</span> <span class="s2">&quot;p</span><span class="si">{10cm}</span><span class="s2"> X[c] X[l]&quot;</span>
</span><span id="line-1278">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1279">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Center</span><span class="p">())</span> <span class="k">as</span> <span class="n">centered</span><span class="p">:</span>
</span><span id="line-1280">            <span class="k">with</span> <span class="n">centered</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Tabu</span><span class="p">(</span><span class="n">table_format</span><span class="p">,</span> <span class="n">booktabs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="line-1281">                                      <span class="n">row_height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span> <span class="k">as</span> <span class="n">data_table</span><span class="p">:</span>
</span><span id="line-1282">                <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="p">[</span><span class="n">bold</span><span class="p">])</span>
</span><span id="line-1283">                <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1284">                <span class="c1"># Iterate through outputs and generate rows of data to be</span>
</span><span id="line-1285">                <span class="c1"># entered into the table</span>
</span><span id="line-1286">                <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1287">                    <span class="n">parameter_name</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1288">                        <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;name_latex&#39;</span><span class="p">])</span>
</span><span id="line-1289">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1290">                        <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1291">                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]</span> \
</span><span id="line-1292">                            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="line-1293">                        <span class="c1"># Lists describe profiles and should not be put in the</span>
</span><span id="line-1294">                        <span class="c1"># table</span>
</span><span id="line-1295">                        <span class="n">value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">)</span>
</span><span id="line-1296">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">parameter_name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>
</span><span id="line-1297">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1298">                <span class="c1"># Add summed (composite) emission values</span>
</span><span id="line-1299">                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> \
</span><span id="line-1300">                    <span class="p">[</span><span class="s1">&#39;co2_ch4&#39;</span><span class="p">,</span> <span class="s1">&#39;co2_net&#39;</span><span class="p">,</span> <span class="s1">&#39;ch4_net&#39;</span><span class="p">]):</span>
</span><span id="line-1301">                    <span class="k">try</span><span class="p">:</span>
</span><span id="line-1302">                        <span class="n">value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;co2_net&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ch4_net&#39;</span><span class="p">],</span>
</span><span id="line-1303">                                         <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">)</span>
</span><span id="line-1304">                        <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1305">                            <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="s1">&#39;co2_ch4&#39;</span><span class="p">][</span>
</span><span id="line-1306">                                <span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1307">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">NoEscape</span><span class="p">(</span><span class="s1">&#39;CO$_2$+CH$_4$ net emissions&#39;</span><span class="p">),</span> <span class="n">unit</span><span class="p">,</span>
</span><span id="line-1308">                               <span class="n">value</span><span class="p">]</span>
</span><span id="line-1309">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1310">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1311">                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-1312">                        <span class="c1"># Do not output anything if one of the data (either)</span>
</span><span id="line-1313">                        <span class="c1"># CO2 net or CH4 net are not included in the results</span>
</span><span id="line-1314">                        <span class="k">pass</span>
</span><span id="line-1315">                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> \
</span><span id="line-1316">                    <span class="p">[</span><span class="s1">&#39;co2_ch4_n2o&#39;</span><span class="p">,</span> <span class="s1">&#39;co2_net&#39;</span><span class="p">,</span> <span class="s1">&#39;ch4_net&#39;</span><span class="p">,</span> <span class="s1">&#39;n2o_mean&#39;</span><span class="p">]):</span>
</span><span id="line-1317">                    <span class="k">try</span><span class="p">:</span>
</span><span id="line-1318">                        <span class="n">value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span>
</span><span id="line-1319">                            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;co2_net&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ch4_net&#39;</span><span class="p">]</span> <span class="o">+</span>
</span><span id="line-1320">                            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;n2o_mean&#39;</span><span class="p">],</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">)</span>
</span><span id="line-1321">                        <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1322">                            <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span>
</span><span id="line-1323">                                <span class="s1">&#39;co2_ch4_n2o&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1324">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">NoEscape</span><span class="p">(</span><span class="s1">&#39;CO$_2$+CH$_4$+N$_2$O net emissions&#39;</span><span class="p">),</span>
</span><span id="line-1325">                               <span class="n">unit</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>
</span><span id="line-1326">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1327">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1328">                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="line-1329">                        <span class="c1"># Do not output anything if one of the data (either)</span>
</span><span id="line-1330">                        <span class="c1"># CO2 net or CH4 net are not included in the results</span>
</span><span id="line-1331">                        <span class="k">pass</span></div>

</span><span id="line-1332">
<div class="viewcode-block" id="LatexWriter.add_inputs_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_inputs_table">[docs]</a>
</span><span id="line-1333">    <span class="k">def</span><span class="w"> </span><span class="nf">add_inputs_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1334"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add information with model inputs (for each reservoir).</span>
</span><span id="line-1335">
</span><span id="line-1336"><span class="sd">        Args:</span>
</span><span id="line-1337"><span class="sd">            output_name (str): Name of the output/reservoir.</span>
</span><span id="line-1338"><span class="sd">            precision (int): Number of decimal points in the output input values.</span>
</span><span id="line-1339"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1340">        <span class="n">round_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;round-precision&#39;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
</span><span id="line-1341">                         <span class="s1">&#39;round-mode&#39;</span><span class="p">:</span> <span class="s1">&#39;figures&#39;</span><span class="p">}</span>
</span><span id="line-1342">        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span> <span class="s2">&quot;Value(s)&quot;</span><span class="p">]</span>
</span><span id="line-1343">        <span class="n">table_format</span> <span class="o">=</span> <span class="s2">&quot;X[l] X[c] X[l]&quot;</span>
</span><span id="line-1344">        <span class="c1"># Get inputs and input config</span>
</span><span id="line-1345">        <span class="n">input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</span><span id="line-1346">        <span class="n">included_inputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-1347">        <span class="k">for</span> <span class="n">input_name</span> <span class="ow">in</span> <span class="n">INPUT_NAMES</span><span class="p">:</span>
</span><span id="line-1348">            <span class="n">input_data_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1349">            <span class="k">if</span> <span class="n">input_data_conf</span><span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
</span><span id="line-1350">                <span class="n">included_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_name</span><span class="p">)</span>
</span><span id="line-1351">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">included_inputs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="line-1352">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-1353">        <span class="c1"># If there are inputs to be added to the table, proceed with</span>
</span><span id="line-1354">        <span class="c1"># constructing the table</span>
</span><span id="line-1355">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Center</span><span class="p">())</span> <span class="k">as</span> <span class="n">centered</span><span class="p">:</span>
</span><span id="line-1356">            <span class="k">with</span> <span class="n">centered</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Tabu</span><span class="p">(</span><span class="n">table_format</span><span class="p">,</span> <span class="n">booktabs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="line-1357">                                      <span class="n">row_height</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span> <span class="k">as</span> <span class="n">data_table</span><span class="p">:</span>
</span><span id="line-1358">                <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="p">[</span><span class="n">bold</span><span class="p">])</span>
</span><span id="line-1359">                <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1360">                <span class="c1"># Add stuff to the table if they&#39;re to be included</span>
</span><span id="line-1361">                <span class="n">printout</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="line-1362">                <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1363">                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1364">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1365">                        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1366">                    <span class="n">input_value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
</span><span id="line-1367">                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value_str</span><span class="p">]</span>
</span><span id="line-1368">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1369">                    <span class="n">printout</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="line-1370">                <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1371">                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1372">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1373">                        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1374">                    <span class="n">input_value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>
</span><span id="line-1375">                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value_str</span><span class="p">]</span>
</span><span id="line-1376">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1377">                    <span class="n">printout</span> <span class="o">=</span> <span class="kc">True</span>                    
</span><span id="line-1378">                <span class="k">if</span> <span class="s2">&quot;coordinates&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1379">                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1380">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1381">                        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1382">                    <span class="n">input_value</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="line-1383">                    <span class="n">input_value_str</span> <span class="o">=</span> <span class="s2">&quot;LAT: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> \
</span><span id="line-1384">                        <span class="s2">&quot;, LON: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="line-1385">                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value_str</span><span class="p">]</span>
</span><span id="line-1386">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1387">                    <span class="n">printout</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="line-1388">                <span class="k">if</span> <span class="s2">&quot;monthly_temps&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1389">                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;monthly_temps&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1390">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1391">                        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;monthly_temps&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1392">                    <span class="n">input_value</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s2">&quot;monthly_temps&quot;</span><span class="p">]</span>
</span><span id="line-1393">                    <span class="n">input_value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span>
</span><span id="line-1394">                                             <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-1395">                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value</span><span class="p">]</span>
</span><span id="line-1396">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1397">                    <span class="n">printout</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="line-1398">                <span class="k">if</span> <span class="s2">&quot;year_profile&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1399">                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;year_profile&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1400">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span>
</span><span id="line-1401">                        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;year_profile&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1402">                    <span class="n">input_value</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s2">&quot;year_vector&quot;</span><span class="p">]</span>
</span><span id="line-1403">                    <span class="n">input_value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span>
</span><span id="line-1404">                                             <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-1405">                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value</span><span class="p">]</span>
</span><span id="line-1406">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1407">                    <span class="n">printout</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="line-1408">                <span class="k">if</span> <span class="s2">&quot;gasses&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1409">                    <span class="n">gas_name_latex</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;co2&#39;</span><span class="p">:</span> <span class="s1">&#39;CO$_2$&#39;</span><span class="p">,</span> <span class="s1">&#39;ch4&#39;</span><span class="p">:</span> <span class="s1">&#39;CH$_4$&#39;</span><span class="p">,</span>
</span><span id="line-1410">                                      <span class="s1">&#39;n2o&#39;</span><span class="p">:</span> <span class="s1">&#39;N$_2$O&#39;</span><span class="p">}</span>
</span><span id="line-1411">                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;gasses&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1412">                    <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;gasses&#39;</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1413">                    <span class="n">input_value</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s2">&quot;gasses&quot;</span><span class="p">]</span>
</span><span id="line-1414">                    <span class="n">gases_latex</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="line-1415">                        <span class="p">[</span><span class="n">gas_name_latex</span><span class="p">[</span><span class="n">gas</span><span class="p">]</span> <span class="k">for</span> <span class="n">gas</span> <span class="ow">in</span> <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-1416">                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">NoEscape</span><span class="p">(</span><span class="n">gases_latex</span><span class="p">)]</span>
</span><span id="line-1417">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1418">                    <span class="n">printout</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="line-1419">                <span class="k">if</span> <span class="n">printout</span><span class="p">:</span>
</span><span id="line-1420">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1421">                <span class="c1"># Add biogenic factors</span>
</span><span id="line-1422">                <span class="k">if</span> <span class="s1">&#39;biogenic_factors&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1423">                    <span class="n">row_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;biogenic_factors&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1424">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="line-1425">                        <span class="p">(</span><span class="n">MultiColumn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">row_name</span><span class="p">),))</span>
</span><span id="line-1426">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1427">                    <span class="c1"># Check if biogenic factors are of BiogenicFactors type</span>
</span><span id="line-1428">                    <span class="c1"># instead of a dictionary - the data is a dictionary in</span>
</span><span id="line-1429">                    <span class="c1"># text input files but then is converted to BiogenicFactors</span>
</span><span id="line-1430">                    <span class="c1"># type</span>
</span><span id="line-1431">                    <span class="n">biogenic_factors</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span>
</span><span id="line-1432">                        <span class="s1">&#39;catchment&#39;</span><span class="p">][</span><span class="s1">&#39;biogenic_factors&#39;</span><span class="p">]</span>
</span><span id="line-1433">                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">biogenic_factors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="line-1434">                        <span class="k">try</span><span class="p">:</span>
</span><span id="line-1435">                            <span class="n">biogenic_factors</span> <span class="o">=</span> <span class="n">biogenic_factors</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
</span><span id="line-1436">                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="line-1437">                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Variable biogenic factors cannot be &#39;</span> <span class="o">+</span>
</span><span id="line-1438">                                      <span class="s1">&#39;converted to a dictionary&#39;</span><span class="p">)</span>
</span><span id="line-1439">
</span><span id="line-1440">                    <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">biogenic_factors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1441">                        <span class="n">name</span> <span class="o">=</span> <span class="n">FACTOR_NAMES</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1442">                        <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
</span><span id="line-1443">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value</span><span class="p">]</span>
</span><span id="line-1444">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1445">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1446">
</span><span id="line-1447">                <span class="c1"># Add catchment inputs</span>
</span><span id="line-1448">                <span class="k">if</span> <span class="s1">&#39;catchment_inputs&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1449">                    <span class="n">row_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;catchment_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1450">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="line-1451">                        <span class="p">(</span><span class="n">MultiColumn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">row_name</span><span class="p">),))</span>
</span><span id="line-1452">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1453">                    <span class="c1"># Get input data</span>
</span><span id="line-1454">                    <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> \
</span><span id="line-1455">                            <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1456">                        <span class="k">if</span> <span class="n">input_name</span> <span class="o">==</span> <span class="s1">&#39;biogenic_factors&#39;</span><span class="p">:</span>
</span><span id="line-1457">                            <span class="k">break</span>
</span><span id="line-1458">                        <span class="c1"># Get input name and unit from config</span>
</span><span id="line-1459">                        <span class="n">conf_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span>
</span><span id="line-1460">                            <span class="s1">&#39;catchment_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;var_dict&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1461">                        <span class="n">name</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1462">                        <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span><span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1463">                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="line-1464">                            <span class="n">input_value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span>
</span><span id="line-1465">                                <span class="n">input_value</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">)</span>
</span><span id="line-1466">                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-1467">                            <span class="k">pass</span>
</span><span id="line-1468">                        <span class="k">else</span><span class="p">:</span>
</span><span id="line-1469">                            <span class="n">input_value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="line-1470">                                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-1471">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value</span><span class="p">]</span>
</span><span id="line-1472">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1473">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1474">
</span><span id="line-1475">                <span class="c1"># Add reservoir inputs</span>
</span><span id="line-1476">                <span class="k">if</span> <span class="s1">&#39;reservoir_inputs&#39;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1477">                    <span class="n">row_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1478">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
</span><span id="line-1479">                        <span class="p">(</span><span class="n">MultiColumn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">row_name</span><span class="p">),))</span>
</span><span id="line-1480">                    <span class="n">data_table</span><span class="o">.</span><span class="n">add_hline</span><span class="p">()</span>
</span><span id="line-1481">                    <span class="c1"># Get input data</span>
</span><span id="line-1482">                    <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> \
</span><span id="line-1483">                            <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1484">                        <span class="c1"># Get input name and unit from config</span>
</span><span id="line-1485">                        <span class="n">conf_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span>
</span><span id="line-1486">                            <span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;var_dict&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1487">                        <span class="n">name</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1488">                        <span class="n">unit</span> <span class="o">=</span> <span class="n">NoEscape</span><span class="p">(</span><span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">])</span>
</span><span id="line-1489">                        <span class="k">if</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1490">                            <span class="c1"># Convert None into empty string</span>
</span><span id="line-1491">                            <span class="n">input_value</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="line-1492">                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="line-1493">                            <span class="n">input_value</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span>
</span><span id="line-1494">                                <span class="n">input_value</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">round_options</span><span class="p">)</span>
</span><span id="line-1495">                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-1496">                            <span class="k">pass</span>
</span><span id="line-1497">                        <span class="k">else</span><span class="p">:</span>
</span><span id="line-1498">                            <span class="n">input_value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="line-1499">                                <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_value</span><span class="p">])</span>
</span><span id="line-1500">                        <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">input_value</span><span class="p">]</span>
</span><span id="line-1501">                        <span class="n">data_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="line-1502">        <span class="k">return</span> <span class="kc">None</span></div>

</span><span id="line-1503">
<div class="viewcode-block" id="LatexWriter.add_header">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_header">[docs]</a>
</span><span id="line-1504">    <span class="k">def</span><span class="w"> </span><span class="nf">add_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GHG emission estimation results&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1505"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1506"><span class="sd">        Adds a header to the LaTeX document source code.</span>
</span><span id="line-1507">
</span><span id="line-1508"><span class="sd">        Args:</span>
</span><span id="line-1509"><span class="sd">            header_title (str): The title to be added in the header. Defaults to &quot;GHG emission estimation results&quot;.</span>
</span><span id="line-1510">
</span><span id="line-1511"><span class="sd">        Returns:</span>
</span><span id="line-1512"><span class="sd">            None</span>
</span><span id="line-1513"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1514">        <span class="n">header</span> <span class="o">=</span> <span class="n">PageStyle</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
</span><span id="line-1515">        <span class="c1"># Create center header</span>
</span><span id="line-1516">        <span class="k">with</span> <span class="n">header</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Head</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)):</span>
</span><span id="line-1517">            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header_title</span><span class="p">)</span>
</span><span id="line-1518">        <span class="c1"># Create right header</span>
</span><span id="line-1519">        <span class="k">with</span> <span class="n">header</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Head</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)):</span>
</span><span id="line-1520">            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simple_page_number</span><span class="p">())</span>
</span><span id="line-1521">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
</span><span id="line-1522">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">change_document_style</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span></div>

</span><span id="line-1523">
<div class="viewcode-block" id="LatexWriter.add_title_section">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_title_section">[docs]</a>
</span><span id="line-1524">    <span class="k">def</span><span class="w"> </span><span class="nf">add_title_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">author</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1525"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1526"><span class="sd">        Writes the title section to the LaTeX document source code.</span>
</span><span id="line-1527">
</span><span id="line-1528"><span class="sd">        Args:</span>
</span><span id="line-1529"><span class="sd">            title (str): The title of the document.</span>
</span><span id="line-1530"><span class="sd">            author (str): The author of the document.</span>
</span><span id="line-1531">
</span><span id="line-1532"><span class="sd">        Returns:</span>
</span><span id="line-1533"><span class="sd">            None</span>
</span><span id="line-1534"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1535">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
</span><span id="line-1536">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">author</span><span class="p">))</span>
</span><span id="line-1537">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\today&#39;</span><span class="p">)))</span>
</span><span id="line-1538">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\maketitle&#39;</span><span class="p">))</span></div>

</span><span id="line-1539">
<div class="viewcode-block" id="LatexWriter.add_parameters_section">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_parameters_section">[docs]</a>
</span><span id="line-1540">    <span class="k">def</span><span class="w"> </span><span class="nf">add_parameters_section</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1541"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1542"><span class="sd">        Writes model parameter information to the LaTeX document source code.</span>
</span><span id="line-1543">
</span><span id="line-1544"><span class="sd">        Args:</span>
</span><span id="line-1545"><span class="sd">            None</span>
</span><span id="line-1546">
</span><span id="line-1547"><span class="sd">        Returns:</span>
</span><span id="line-1548"><span class="sd">            None</span>
</span><span id="line-1549"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1550">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s1">&#39;Global parameters&#39;</span><span class="p">)):</span>
</span><span id="line-1551">            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameters</span><span class="p">()</span>
</span><span id="line-1552">        <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\pagebreak&#39;</span><span class="p">))</span></div>

</span><span id="line-1553">
<div class="viewcode-block" id="LatexWriter.add_inputs_subsection">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_inputs_subsection">[docs]</a>
</span><span id="line-1554">    <span class="k">def</span><span class="w"> </span><span class="nf">add_inputs_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1555"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1556"><span class="sd">        Writes inputs information to the LaTeX document source code.</span>
</span><span id="line-1557">
</span><span id="line-1558"><span class="sd">        Args:</span>
</span><span id="line-1559"><span class="sd">            reservoir_name (str): The name of the reservoir.</span>
</span><span id="line-1560">
</span><span id="line-1561"><span class="sd">        Returns:</span>
</span><span id="line-1562"><span class="sd">            None</span>
</span><span id="line-1563"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1564">        <span class="c1"># Add inputs section to the document</span>
</span><span id="line-1565">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s1">&#39;Inputs&#39;</span><span class="p">)):</span>
</span><span id="line-1566">            <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs_table</span><span class="p">(</span><span class="n">output_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span></div>

</span><span id="line-1567">
<div class="viewcode-block" id="LatexWriter.add_outputs_subsection">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_outputs_subsection">[docs]</a>
</span><span id="line-1568">    <span class="k">def</span><span class="w"> </span><span class="nf">add_outputs_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1569"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1570"><span class="sd">        Writes outputs information to the LaTeX document source code.</span>
</span><span id="line-1571">
</span><span id="line-1572"><span class="sd">        Args:</span>
</span><span id="line-1573"><span class="sd">            reservoir_name (str): The name of the reservoir.</span>
</span><span id="line-1574">
</span><span id="line-1575"><span class="sd">        Returns:</span>
</span><span id="line-1576"><span class="sd">            None</span>
</span><span id="line-1577"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1578">        <span class="n">plot_fraction</span> <span class="o">=</span> <span class="mf">0.75</span>
</span><span id="line-1579">        <span class="c1"># Add inputs section to the document</span>
</span><span id="line-1580">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s1">&#39;Outputs&#39;</span><span class="p">)):</span>
</span><span id="line-1581">            <span class="bp">self</span><span class="o">.</span><span class="n">add_outputs_table</span><span class="p">(</span><span class="n">output_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-1582">            <span class="bp">self</span><span class="o">.</span><span class="n">add_plots</span><span class="p">(</span><span class="n">output_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">,</span>
</span><span id="line-1583">                           <span class="n">plot_fraction</span><span class="o">=</span><span class="n">plot_fraction</span><span class="p">)</span></div>

</span><span id="line-1584">            
<div class="viewcode-block" id="LatexWriter.add_intern_var_subsection">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.add_intern_var_subsection">[docs]</a>
</span><span id="line-1585">    <span class="k">def</span><span class="w"> </span><span class="nf">add_intern_var_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1586"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1587"><span class="sd">        Writes internal variable information to the LaTeX document source code.</span>
</span><span id="line-1588">
</span><span id="line-1589"><span class="sd">        Args:</span>
</span><span id="line-1590"><span class="sd">            reservoir_name (str): The name of the reservoir.</span>
</span><span id="line-1591">
</span><span id="line-1592"><span class="sd">        Returns:</span>
</span><span id="line-1593"><span class="sd">            None</span>
</span><span id="line-1594"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1595">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s1">&#39;Intermediate variables&#39;</span><span class="p">)):</span>
</span><span id="line-1596">            <span class="bp">self</span><span class="o">.</span><span class="n">add_intern_vars_table</span><span class="p">(</span><span class="n">output_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span></div>

</span><span id="line-1597">
<div class="viewcode-block" id="LatexWriter.write">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.LatexWriter.write">[docs]</a>
</span><span id="line-1598">    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1599"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-1600"><span class="sd">        Writes output data (all reservoirs) to .tex and .pdf files.</span>
</span><span id="line-1601">
</span><span id="line-1602"><span class="sd">        Args:</span>
</span><span id="line-1603"><span class="sd">            None</span>
</span><span id="line-1604">
</span><span id="line-1605"><span class="sd">        Returns:</span>
</span><span id="line-1606"><span class="sd">            None</span>
</span><span id="line-1607"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-1608">        <span class="c1"># Read data from configuration</span>
</span><span id="line-1609">        <span class="n">app_config</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;app_config&quot;</span><span class="p">)</span>
</span><span id="line-1610">        <span class="n">clean_tex</span> <span class="o">=</span> <span class="n">app_config</span><span class="p">[</span><span class="s1">&#39;latex&#39;</span><span class="p">][</span><span class="s1">&#39;clean_tex&#39;</span><span class="p">]</span>
</span><span id="line-1611">        <span class="n">compilations</span> <span class="o">=</span> <span class="n">app_config</span><span class="p">[</span><span class="s1">&#39;latex&#39;</span><span class="p">][</span><span class="s1">&#39;compilations&#39;</span><span class="p">]</span>
</span><span id="line-1612">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="line-1613">            <span class="c1"># If outputs are None or an empty dictionary.</span>
</span><span id="line-1614">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-1615">        <span class="k">if</span> <span class="n">is_latex_installed</span><span class="p">():</span>
</span><span id="line-1616">            <span class="bp">self</span><span class="o">.</span><span class="n">add_header</span><span class="p">()</span>
</span><span id="line-1617">            <span class="bp">self</span><span class="o">.</span><span class="n">add_title_section</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
</span><span id="line-1618">            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameters_section</span><span class="p">()</span>
</span><span id="line-1619">            <span class="c1"># Iterate through all reservoirs in outputs and write to tex</span>
</span><span id="line-1620">            <span class="k">for</span> <span class="n">reservoir_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
</span><span id="line-1621">                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)):</span>
</span><span id="line-1622">                    <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs_subsection</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-1623">                    <span class="bp">self</span><span class="o">.</span><span class="n">add_landcover_charts</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-1624">                    <span class="bp">self</span><span class="o">.</span><span class="n">add_outputs_subsection</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-1625">                    <span class="bp">self</span><span class="o">.</span><span class="n">add_intern_var_subsection</span><span class="p">(</span><span class="n">reservoir_name</span><span class="o">=</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-1626">            <span class="c1"># Generate a PDF (requires a LaTeX compiler present in the system)</span>
</span><span id="line-1627">            <span class="n">BatchCompiler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document</span><span class="p">)</span><span class="o">.</span><span class="n">generate_pdf</span><span class="p">(</span>
</span><span id="line-1628">                <span class="n">clean_tex</span><span class="o">=</span><span class="n">clean_tex</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">_get_latex_compiler</span><span class="p">(),</span> 
</span><span id="line-1629">                <span class="n">compilations</span><span class="o">=</span><span class="n">compilations</span><span class="p">)</span>
</span><span id="line-1630">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Created a PDF file with outputs.&quot;</span><span class="p">)</span>
</span><span id="line-1631">        <span class="k">else</span><span class="p">:</span>
</span><span id="line-1632">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="line-1633">                <span class="s2">&quot;LaTeX compiler cannot be found in your environment.&quot;</span> <span class="o">+</span>
</span><span id="line-1634">                <span class="s2">&quot;&#39;.tex&#39; and &#39;.pdf&#39; files could not be created.&quot;</span><span class="p">)</span>
</span><span id="line-1635">        <span class="k">return</span> <span class="kc">None</span></div>
</div>

</span><span id="line-1636">
</span><span id="line-1637">
<div class="viewcode-block" id="HTMLWriter">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter">[docs]</a>
</span><span id="line-1638"><span class="nd">@dataclass</span>
</span><span id="line-1639"><span class="k">class</span><span class="w"> </span><span class="nc">HTMLWriter</span><span class="p">(</span><span class="n">Writer</span><span class="p">):</span>
</span><span id="line-1640"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Format and write data to an HTML file.&quot;&quot;&quot;</span>
</span><span id="line-1641">
</span><span id="line-1642">    <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span>
</span><span id="line-1643">    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1644">    <span class="n">intern_vars</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1645">    <span class="n">output_file_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-1646">    <span class="n">output_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1647">    <span class="n">input_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1648">    <span class="n">intern_vars_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1649">    <span class="n">parameter_config</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1650">    <span class="n">config_ini</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-1651">    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-1652">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-1653">    <span class="n">html_fragments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</span><span id="line-1654">
<div class="viewcode-block" id="HTMLWriter.__post_init__">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.__post_init__">[docs]</a>
</span><span id="line-1655">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1656"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the HTML content with a basic structure.&quot;&quot;&quot;</span>
</span><span id="line-1657">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="line-1658"><span class="s2">            &lt;!DOCTYPE html&gt;</span>
</span><span id="line-1659"><span class="s2">            &lt;html lang=&quot;en&quot;&gt;</span>
</span><span id="line-1660"><span class="s2">            &lt;head&gt;</span>
</span><span id="line-1661"><span class="s2">                &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
</span><span id="line-1662"><span class="s2">                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
</span><span id="line-1663"><span class="s2">                &lt;title&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/title&gt;</span>
</span><span id="line-1664"><span class="s2">                &lt;style&gt;</span>
</span><span id="line-1665"><span class="s2">                    :root </span><span class="se">{{</span>
</span><span id="line-1666"><span class="s2">                        --bg-color: #f9f9f9;</span>
</span><span id="line-1667"><span class="s2">                        --text-color: #333;</span>
</span><span id="line-1668"><span class="s2">                        --panel-bg: #ffffff;</span>
</span><span id="line-1669"><span class="s2">                        --border-color: #ccc;</span>
</span><span id="line-1670"><span class="s2">                        --reservoir-links-bg: #eaeaea; /* Default light mode background */</span>
</span><span id="line-1671"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1672"><span class="s2">                    body </span><span class="se">{{</span>
</span><span id="line-1673"><span class="s2">                        background-color: var(--bg-color);</span>
</span><span id="line-1674"><span class="s2">                        color: var(--text-color);</span>
</span><span id="line-1675"><span class="s2">                        transition: background-color 0.3s, color 0.3s;</span>
</span><span id="line-1676"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1677"><span class="s2">                    .dark-mode </span><span class="se">{{</span>
</span><span id="line-1678"><span class="s2">                        --bg-color: #121212;</span>
</span><span id="line-1679"><span class="s2">                        --text-color: #e0e0e0;</span>
</span><span id="line-1680"><span class="s2">                        --panel-bg: #1e1e1e;</span>
</span><span id="line-1681"><span class="s2">                        --border-color: #444;</span>
</span><span id="line-1682"><span class="s2">                        --reservoir-links-bg: #333333; /* Dark mode background */</span>
</span><span id="line-1683"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1684"><span class="s2">                    h1, h2, h3 </span><span class="se">{{</span>
</span><span id="line-1685"><span class="s2">                        color: var(--text-color);</span>
</span><span id="line-1686"><span class="s2">                        border-bottom: 1px solid var(--border-color);</span>
</span><span id="line-1687"><span class="s2">                        padding-bottom: 0.2em;</span>
</span><span id="line-1688"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1689"><span class="s2">                    h1 </span><span class="se">{{</span><span class="s2"> font-size: 2.5rem; </span><span class="se">}}</span>
</span><span id="line-1690"><span class="s2">                    h2 </span><span class="se">{{</span><span class="s2"> font-size: 2rem; </span><span class="se">}}</span>
</span><span id="line-1691"><span class="s2">                    h3 </span><span class="se">{{</span><span class="s2"> font-size: 1.5rem; </span><span class="se">}}</span>
</span><span id="line-1692"><span class="s2">                    table td, table th </span><span class="se">{{</span><span class="s2"> font-size: 1.3rem; </span><span class="se">}}</span>
</span><span id="line-1693"><span class="s2">                    table </span><span class="se">{{</span>
</span><span id="line-1694"><span class="s2">                        border-collapse: collapse;</span>
</span><span id="line-1695"><span class="s2">                        width: 100%;</span>
</span><span id="line-1696"><span class="s2">                        margin: 20px 0;</span>
</span><span id="line-1697"><span class="s2">                        background-color: #fff;</span>
</span><span id="line-1698"><span class="s2">                        box-shadow: 0 0 4px rgba(0,0,0,0.1);</span>
</span><span id="line-1699"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1700"><span class="s2">                    th, td </span><span class="se">{{</span>
</span><span id="line-1701"><span class="s2">                        border: 1px solid #ccc;</span>
</span><span id="line-1702"><span class="s2">                        padding: 8px 12px;</span>
</span><span id="line-1703"><span class="s2">                        text-align: left;</span>
</span><span id="line-1704"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1705"><span class="s2">                    th </span><span class="se">{{</span>
</span><span id="line-1706"><span class="s2">                        background-color: var(--panel-bg); /* or a slight variation */</span>
</span><span id="line-1707"><span class="s2">                        color: var(--text-color);</span>
</span><span id="line-1708"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1709"><span class="s2">                    figure </span><span class="se">{{</span>
</span><span id="line-1710"><span class="s2">                        margin: 20px 0;</span>
</span><span id="line-1711"><span class="s2">                        padding: 10px;</span>
</span><span id="line-1712">
</span><span id="line-1713"><span class="s2">                        background-color: var(--panel-bg);</span>
</span><span id="line-1714"><span class="s2">                        color: var(--text-color);</span>
</span><span id="line-1715"><span class="s2">                        border: 1px solid #ddd;</span>
</span><span id="line-1716"><span class="s2">                        border-radius: 4px;</span>
</span><span id="line-1717"><span class="s2">                        box-shadow: 0 0 4px rgba(0,0,0,0.05);</span>
</span><span id="line-1718"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1719"><span class="s2">                    figcaption </span><span class="se">{{</span>
</span><span id="line-1720"><span class="s2">                        margin-top: 8px;</span>
</span><span id="line-1721"><span class="s2">                        font-style: italic;</span>
</span><span id="line-1722"><span class="s2">                        color: var(--text-color);</span>
</span><span id="line-1723"><span class="s2">                        font-size: 1em;</span>
</span><span id="line-1724"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1725"><span class="s2">                    .export-btn </span><span class="se">{{</span>
</span><span id="line-1726"><span class="s2">                        margin-top: 10px;</span>
</span><span id="line-1727"><span class="s2">                        margin-bottom: 20px;</span>
</span><span id="line-1728"><span class="s2">                        padding: 5px 10px;</span>
</span><span id="line-1729"><span class="s2">                        background: #3498db;</span>
</span><span id="line-1730"><span class="s2">                        color: white;</span>
</span><span id="line-1731"><span class="s2">                        border: none;</span>
</span><span id="line-1732"><span class="s2">                        border-radius: 4px;</span>
</span><span id="line-1733"><span class="s2">                        cursor: pointer;</span>
</span><span id="line-1734"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1735"><span class="s2">                    .toggle-theme </span><span class="se">{{</span>
</span><span id="line-1736"><span class="s2">                        </span>
</span><span id="line-1737"><span class="s2">                        background: var(--text-color);</span>
</span><span id="line-1738"><span class="s2">                        color: var(--bg-color);</span>
</span><span id="line-1739"><span class="s2">                        position: fixed;</span>
</span><span id="line-1740"><span class="s2">                        top: 10px;</span>
</span><span id="line-1741"><span class="s2">                        right: 20px;</span>
</span><span id="line-1742"><span class="s2">                        z-index: 1001;</span>
</span><span id="line-1743"><span class="s2">                        cursor: pointer;</span>
</span><span id="line-1744"><span class="s2">                        padding: 6px 12px;</span>
</span><span id="line-1745"><span class="s2">                        border: none;</span>
</span><span id="line-1746"><span class="s2">                        border-radius: 4px;</span>
</span><span id="line-1747"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1748"><span class="s2">                    #reservoir-links </span><span class="se">{{</span>
</span><span id="line-1749"><span class="s2">                        display: flex;</span>
</span><span id="line-1750"><span class="s2">                        overflow-x: auto;</span>
</span><span id="line-1751"><span class="s2">                        white-space: nowrap;</span>
</span><span id="line-1752"><span class="s2">                        gap: 10px;</span>
</span><span id="line-1753"><span class="s2">                        padding: 10px 20px;</span>
</span><span id="line-1754"><span class="s2">                        background-color: var(--reservoir-links-bg); /* Use the CSS variable */</span>
</span><span id="line-1755"><span class="s2">                        border-bottom: 1px solid var(--border-color);</span>
</span><span id="line-1756"><span class="s2">                        position: sticky;</span>
</span><span id="line-1757"><span class="s2">                        top: 0;</span>
</span><span id="line-1758"><span class="s2">                        z-index: 500;</span>
</span><span id="line-1759"><span class="s2">                         margin-bottom: 20px;</span>
</span><span id="line-1760"><span class="s2">                    </span><span class="se">}}</span><span class="s2">                    </span>
</span><span id="line-1761"><span class="s2">                    #reservoir-links a </span><span class="se">{{</span>
</span><span id="line-1762"><span class="s2">                        padding: 6px 12px;</span>
</span><span id="line-1763"><span class="s2">                        background-color: #3498db;</span>
</span><span id="line-1764"><span class="s2">                        color: white;</span>
</span><span id="line-1765"><span class="s2">                        border-radius: 4px;</span>
</span><span id="line-1766"><span class="s2">                        text-decoration: none;</span>
</span><span id="line-1767"><span class="s2">                        font-size: 0.9em;</span>
</span><span id="line-1768"><span class="s2">                        flex: 0 0 auto;</span>
</span><span id="line-1769"><span class="s2">                        transition: background-color 0.2s;</span>
</span><span id="line-1770"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1771"><span class="s2">                    #reservoir-links a:hover </span><span class="se">{{</span>
</span><span id="line-1772"><span class="s2">                        background-color: #217dbb;</span>
</span><span id="line-1773"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1774"><span class="s2">                    details </span><span class="se">{{</span>
</span><span id="line-1775"><span class="s2">                        margin-bottom: 1.5em;</span>
</span><span id="line-1776"><span class="s2">                        background-color: #ffffff;</span>
</span><span id="line-1777"><span class="s2">                        padding: 1em;</span>
</span><span id="line-1778"><span class="s2">                        border: 1px solid #ccc;</span>
</span><span id="line-1779"><span class="s2">                        border-radius: 5px;</span>
</span><span id="line-1780"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1781"><span class="s2">                    summary </span><span class="se">{{</span>
</span><span id="line-1782"><span class="s2">                        font-size: 1.3em;</span>
</span><span id="line-1783"><span class="s2">                        font-weight: bold;</span>
</span><span id="line-1784"><span class="s2">                        cursor: pointer;</span>
</span><span id="line-1785"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1786"><span class="s2">                    details,</span>
</span><span id="line-1787"><span class="s2">                    table,</span>
</span><span id="line-1788"><span class="s2">                    figure,</span>
</span><span id="line-1789"><span class="s2">                    summary,</span>
</span><span id="line-1790"><span class="s2">                    th,</span>
</span><span id="line-1791"><span class="s2">                    td,</span>
</span><span id="line-1792"><span class="s2">                    figcaption </span><span class="se">{{</span>
</span><span id="line-1793"><span class="s2">                        background-color: var(--panel-bg);</span>
</span><span id="line-1794"><span class="s2">                        color: var(--text-color);</span>
</span><span id="line-1795"><span class="s2">                        border-color: var(--border-color);</span>
</span><span id="line-1796"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1797"><span class="s2">                    table, th, td </span><span class="se">{{</span>
</span><span id="line-1798"><span class="s2">                        border: 1px solid var(--border-color);</span>
</span><span id="line-1799"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1800"><span class="s2">                    th </span><span class="se">{{</span>
</span><span id="line-1801"><span class="s2">                        background-color: rgba(255, 255, 255, 0.05); /* subtle header contrast */</span>
</span><span id="line-1802"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1803"><span class="s2">                    figcaption </span><span class="se">{{</span>
</span><span id="line-1804"><span class="s2">                        font-style: italic;</span>
</span><span id="line-1805"><span class="s2">                        opacity: 0.8;</span>
</span><span id="line-1806"><span class="s2">                    </span><span class="se">}}</span>
</span><span id="line-1807"><span class="s2">                &lt;/style&gt;</span>
</span><span id="line-1808"><span class="s2">                &lt;script&gt;</span>
</span><span id="line-1809"><span class="s2">                function toggleTheme() </span><span class="se">{{</span>
</span><span id="line-1810"><span class="s2">                    document.body.classList.toggle(&#39;dark-mode&#39;);</span>
</span><span id="line-1811"><span class="s2">                </span><span class="se">}}</span>
</span><span id="line-1812"><span class="s2">                function exportSection(id, name) </span><span class="se">{{</span>
</span><span id="line-1813"><span class="s2">                    const el = document.getElementById(id);</span>
</span><span id="line-1814"><span class="s2">                    const blob = new Blob([el.innerHTML], </span><span class="se">{{</span><span class="s2"> type: &#39;text/html&#39; </span><span class="se">}}</span><span class="s2">);</span>
</span><span id="line-1815"><span class="s2">                    const link = document.createElement(&#39;a&#39;);</span>
</span><span id="line-1816"><span class="s2">                    link.href = URL.createObjectURL(blob);</span>
</span><span id="line-1817"><span class="s2">                    link.download = name + &#39;.html&#39;;</span>
</span><span id="line-1818"><span class="s2">                    link.click();</span>
</span><span id="line-1819"><span class="s2">                </span><span class="se">}}</span>
</span><span id="line-1820"><span class="s2">                MathJax = </span><span class="se">{{</span>
</span><span id="line-1821"><span class="s2">                    tex: </span><span class="se">{{</span><span class="s2"> inlineMath: [[&#39;$&#39;, &#39;$&#39;], [&#39;</span><span class="se">\\\\</span><span class="s2">(&#39;, &#39;</span><span class="se">\\\\</span><span class="s2">)&#39;]] </span><span class="se">}}</span><span class="s2">,</span>
</span><span id="line-1822"><span class="s2">                    svg: </span><span class="se">{{</span><span class="s2"> fontCache: &#39;global&#39; </span><span class="se">}}</span>
</span><span id="line-1823"><span class="s2">                </span><span class="se">}}</span><span class="s2">;</span>
</span><span id="line-1824"><span class="s2">                &lt;/script&gt;</span>
</span><span id="line-1825"><span class="s2">                &lt;script src=&quot;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js&quot;&gt;&lt;/script&gt;</span>
</span><span id="line-1826"><span class="s2">            &lt;/head&gt;</span>
</span><span id="line-1827"><span class="s2">            &lt;body&gt;</span>
</span><span id="line-1828"><span class="s2">                &lt;h1&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/h1&gt;</span>
</span><span id="line-1829"><span class="s2">                &lt;p&gt;&lt;strong&gt;Author:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
</span><span id="line-1830"><span class="s2">                &lt;p&gt;&lt;strong&gt;Date:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_current_date</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
</span><span id="line-1831"><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></div>

</span><span id="line-1832">
</span><span id="line-1833">    <span class="nd">@staticmethod</span>
</span><span id="line-1834">    <span class="k">def</span><span class="w"> </span><span class="nf">_get_current_date</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-1835"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current date in a readable format.&quot;&quot;&quot;</span>
</span><span id="line-1836">        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="line-1837">        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">)</span>
</span><span id="line-1838">
<div class="viewcode-block" id="HTMLWriter.add_section">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_section">[docs]</a>
</span><span id="line-1839">    <span class="k">def</span><span class="w"> </span><span class="nf">add_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1840"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a section to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1841">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;h2&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/h2&gt;&quot;</span><span class="p">)</span></div>

</span><span id="line-1842">
<div class="viewcode-block" id="HTMLWriter.add_subsection">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_subsection">[docs]</a>
</span><span id="line-1843">    <span class="k">def</span><span class="w"> </span><span class="nf">add_subsection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1844"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a subsection to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1845">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;h3&gt;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span><span class="p">)</span></div>

</span><span id="line-1846">
<div class="viewcode-block" id="HTMLWriter.add_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_table">[docs]</a>
</span><span id="line-1847">    <span class="k">def</span><span class="w"> </span><span class="nf">add_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">column_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1848"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a table to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1849">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;table&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1850">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;tr&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;th&gt;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&lt;/th&gt;&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1851">        <span class="k">for</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1852">            <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="line-1853">                <span class="n">name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1854">                <span class="n">unit</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="n">parameter</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">]</span>
</span><span id="line-1855">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="line-1856">                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">format_number</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span><span id="line-1857">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-1858">                    <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1859">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-1860">                    <span class="c1"># Assume that if not string, it must be numerical</span>
</span><span id="line-1861">                    <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">format_number</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1862">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">)</span></div>

</span><span id="line-1863">
<div class="viewcode-block" id="HTMLWriter.add_plot">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_plot">[docs]</a>
</span><span id="line-1864">    <span class="k">def</span><span class="w"> </span><span class="nf">add_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">caption</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1865"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a plot to the HTML content using PNG format for faster rendering.&quot;&quot;&quot;</span>
</span><span id="line-1866">        <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="line-1867">        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
</span><span id="line-1868">        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="line-1869">        <span class="n">encoded_image</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="line-1870">        <span class="n">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="line-1871">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="line-1872">            <span class="sa">f</span><span class="s1">&#39;&lt;figure&gt;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">encoded_image</span><span class="si">}</span><span class="s1">&quot; alt=&quot;</span><span class="si">{</span><span class="n">caption</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span>
</span><span id="line-1873">            <span class="sa">f</span><span class="s1">&#39;&lt;figcaption&gt;</span><span class="si">{</span><span class="n">caption</span><span class="si">}</span><span class="s1">&lt;/figcaption&gt;&lt;/figure&gt;&#39;</span>
</span><span id="line-1874">        <span class="p">)</span>
</span><span id="line-1875">        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

</span><span id="line-1876">
<div class="viewcode-block" id="HTMLWriter.add_inputs_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_inputs_table">[docs]</a>
</span><span id="line-1877">    <span class="k">def</span><span class="w"> </span><span class="nf">add_inputs_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1878"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add information with model inputs (for each reservoir) to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1879">        <span class="n">input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</span><span id="line-1880">        <span class="n">included_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">INPUT_NAMES</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;include&#39;</span><span class="p">]]</span>
</span><span id="line-1881">        <span class="k">if</span> <span class="ow">not</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1882">            <span class="k">return</span>
</span><span id="line-1883">
</span><span id="line-1884">        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsection</span><span class="p">(</span><span class="s2">&quot;Inputs&quot;</span><span class="p">)</span>
</span><span id="line-1885">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;table&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1886">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;tr&gt;&lt;th&gt;Input Name&lt;/th&gt;&lt;th&gt;Unit&lt;/th&gt;&lt;th&gt;Value(s)&lt;/th&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1887">
</span><span id="line-1888">        <span class="c1"># Add general inputs</span>
</span><span id="line-1889">        <span class="k">for</span> <span class="n">input_name</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1890">            <span class="k">if</span> <span class="n">input_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">:</span>
</span><span id="line-1891">                <span class="k">continue</span>
</span><span id="line-1892">            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1893">            <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="n">input_name</span><span class="p">][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">]</span>
</span><span id="line-1894">            <span class="n">value</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1895">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="line-1896">                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span><span id="line-1897">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1898">
</span><span id="line-1899">        <span class="c1"># Add biogenic factors</span>
</span><span id="line-1900">        <span class="k">if</span> <span class="s2">&quot;biogenic_factors&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1901">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;text-align:center; font-weight:bold;&#39;&gt;Biogenic Factors&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1902">            <span class="n">biogenic_factors</span> <span class="o">=</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">][</span><span class="s1">&#39;biogenic_factors&#39;</span><span class="p">]</span>
</span><span id="line-1903">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">biogenic_factors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="line-1904">                <span class="k">try</span><span class="p">:</span>
</span><span id="line-1905">                    <span class="n">biogenic_factors</span> <span class="o">=</span> <span class="n">biogenic_factors</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
</span><span id="line-1906">                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="line-1907">                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Variable biogenic factors cannot be converted to a dictionary&quot;</span><span class="p">)</span>
</span><span id="line-1908">            <span class="k">for</span> <span class="n">factor_name</span><span class="p">,</span> <span class="n">factor_value</span> <span class="ow">in</span> <span class="n">biogenic_factors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1909">                <span class="n">name</span> <span class="o">=</span> <span class="n">FACTOR_NAMES</span><span class="p">[</span><span class="n">factor_name</span><span class="p">]</span>
</span><span id="line-1910">                <span class="n">unit</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
</span><span id="line-1911">                <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">factor_value</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1912">
</span><span id="line-1913">        <span class="c1"># Add catchment inputs</span>
</span><span id="line-1914">        <span class="k">if</span> <span class="s2">&quot;catchment_inputs&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1915">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;text-align:center; font-weight:bold;&#39;&gt;Catchment Inputs&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1916">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;catchment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1917">                <span class="k">if</span> <span class="n">input_name</span> <span class="o">==</span> <span class="s2">&quot;biogenic_factors&quot;</span><span class="p">:</span>
</span><span id="line-1918">                    <span class="k">continue</span>
</span><span id="line-1919">                <span class="n">conf_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;catchment_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;var_dict&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1920">                <span class="n">name</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1921">                <span class="n">unit</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">]</span>
</span><span id="line-1922">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="line-1923">                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">input_value</span><span class="p">))</span>
</span><span id="line-1924">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-1925">                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>
</span><span id="line-1926">                <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1927">
</span><span id="line-1928">        <span class="c1"># Add reservoir inputs</span>
</span><span id="line-1929">        <span class="k">if</span> <span class="s2">&quot;reservoir_inputs&quot;</span> <span class="ow">in</span> <span class="n">included_inputs</span><span class="p">:</span>
</span><span id="line-1930">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;text-align:center; font-weight:bold;&#39;&gt;Reservoir Inputs&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1931">            <span class="k">for</span> <span class="n">input_name</span><span class="p">,</span> <span class="n">input_value</span> <span class="ow">in</span> <span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="line-1932">                <span class="n">conf_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">[</span><span class="s1">&#39;reservoir_inputs&#39;</span><span class="p">][</span><span class="s1">&#39;var_dict&#39;</span><span class="p">][</span><span class="n">input_name</span><span class="p">]</span>
</span><span id="line-1933">                <span class="n">name</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span><span id="line-1934">                <span class="n">unit</span> <span class="o">=</span> <span class="n">conf_input</span><span class="p">[</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">]</span>
</span><span id="line-1935">                <span class="k">if</span> <span class="n">input_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1936">                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>
</span><span id="line-1937">                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="line-1938">                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">input_value</span><span class="p">))</span>
</span><span id="line-1939">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-1940">                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>
</span><span id="line-1941">                <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="line-1942">
</span><span id="line-1943">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;/table&gt;&quot;</span><span class="p">)</span></div>

</span><span id="line-1944">
<div class="viewcode-block" id="HTMLWriter.add_outputs_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_outputs_table">[docs]</a>
</span><span id="line-1945">    <span class="k">def</span><span class="w"> </span><span class="nf">add_outputs_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1946"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add outputs table to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1947">        <span class="n">output_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1948">        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsection</span><span class="p">(</span><span class="s2">&quot;Outputs&quot;</span><span class="p">)</span>
</span><span id="line-1949">        <span class="bp">self</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="n">output_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;Output Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">))</span></div>

</span><span id="line-1950">
<div class="viewcode-block" id="HTMLWriter.add_intern_vars_table">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_intern_vars_table">[docs]</a>
</span><span id="line-1951">    <span class="k">def</span><span class="w"> </span><span class="nf">add_intern_vars_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1952"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add internal variables table to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1953">        <span class="n">intern_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1954">        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsection</span><span class="p">(</span><span class="s2">&quot;Internal Variables&quot;</span><span class="p">)</span>
</span><span id="line-1955">        <span class="bp">self</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span><span class="n">intern_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Variable Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">))</span></div>

</span><span id="line-1956">
<div class="viewcode-block" id="HTMLWriter.add_landcover_piecharts">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_landcover_piecharts">[docs]</a>
</span><span id="line-1957">    <span class="k">def</span><span class="w"> </span><span class="nf">add_landcover_piecharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1958"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add landcover piecharts to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1959">        <span class="n">input_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1960">        <span class="n">landcovers_reservoir</span> <span class="o">=</span> <span class="n">parse_landcover_composition</span><span class="p">(</span>
</span><span id="line-1961">            <span class="n">input_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">][</span><span class="s2">&quot;area_fractions&quot;</span><span class="p">])</span>
</span><span id="line-1962">        <span class="n">landcovers_catchment</span> <span class="o">=</span> <span class="n">parse_landcover_composition</span><span class="p">(</span>
</span><span id="line-1963">            <span class="n">input_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;catchment&quot;</span><span class="p">][</span><span class="s2">&quot;area_fractions&quot;</span><span class="p">])</span>
</span><span id="line-1964">        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="line-1965">        <span class="n">landcover_pie</span><span class="p">(</span>
</span><span id="line-1966">            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">landcovers_reservoir</span><span class="p">,</span> <span class="n">landcover_names</span><span class="p">,</span> <span class="n">landcover_colors</span><span class="p">,</span> 
</span><span id="line-1967">            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Reservoir Landcover Composition&quot;</span><span class="p">)</span>
</span><span id="line-1968">        <span class="n">landcover_pie</span><span class="p">(</span>
</span><span id="line-1969">            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">landcovers_catchment</span><span class="p">,</span> <span class="n">landcover_names</span><span class="p">,</span> <span class="n">landcover_colors</span><span class="p">,</span> 
</span><span id="line-1970">            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Catchment Landcover Composition&quot;</span><span class="p">)</span>
</span><span id="line-1971">        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="line-1972">        <span class="bp">self</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;Landcover Composition&quot;</span><span class="p">)</span>
</span><span id="line-1973">        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

</span><span id="line-1974">
<div class="viewcode-block" id="HTMLWriter.add_plots">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.add_plots">[docs]</a>
</span><span id="line-1975">    <span class="k">def</span><span class="w"> </span><span class="nf">add_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-1976"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate and add emission plots to the HTML content.&quot;&quot;&quot;</span>
</span><span id="line-1977">        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="line-1978">        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="line-1979">        <span class="n">emission_var</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="line-1980">            <span class="s2">&quot;co2&quot;</span><span class="p">:</span> <span class="s2">&quot;co2_profile&quot;</span><span class="p">,</span>
</span><span id="line-1981">            <span class="s2">&quot;ch4&quot;</span><span class="p">:</span> <span class="s2">&quot;ch4_profile&quot;</span><span class="p">,</span>
</span><span id="line-1982">            <span class="s2">&quot;n2o&quot;</span><span class="p">:</span> <span class="s2">&quot;n2o_profile&quot;</span><span class="p">}</span>
</span><span id="line-1983">                
</span><span id="line-1984">        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">gas</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">emission_var</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="line-1985">            <span class="k">if</span> <span class="n">gas</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gasses&quot;</span><span class="p">]:</span>
</span><span id="line-1986">                <span class="k">continue</span>
</span><span id="line-1987">            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1988">            <span class="n">years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;year_vector&quot;</span><span class="p">]</span>
</span><span id="line-1989">            <span class="n">emission_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span>
</span><span id="line-1990">                <span class="n">emission_var</span><span class="p">[</span><span class="n">gas</span><span class="p">]][</span><span class="s1">&#39;unit_latex&#39;</span><span class="p">]</span>
</span><span id="line-1991">            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-1992">            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span>
</span><span id="line-1993">                <span class="n">emission_var</span><span class="p">[</span><span class="n">gas</span><span class="p">]][</span><span class="s1">&#39;name_latex&#39;</span><span class="p">],</span> <span class="n">output_name</span><span class="p">))</span>
</span><span id="line-1994">            <span class="c1"># Create title and y_label</span>
</span><span id="line-1995">            <span class="n">y_label</span> <span class="o">=</span> <span class="s2">&quot;Emission, &quot;</span> <span class="o">+</span> <span class="n">emission_unit</span>
</span><span id="line-1996">            <span class="n">emissions</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gas</span><span class="si">}</span><span class="s2">_profile&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="line-1997">            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span>
</span><span id="line-1998">                <span class="n">emission_var</span><span class="p">[</span><span class="n">gas</span><span class="p">]][</span><span class="s1">&#39;name_latex&#39;</span><span class="p">],</span> <span class="n">output_name</span><span class="p">))</span>
</span><span id="line-1999">            <span class="n">emission_profile</span><span class="p">(</span>
</span><span id="line-2000">                <span class="n">axes</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span>
</span><span id="line-2001">                <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">,</span> 
</span><span id="line-2002">                <span class="n">emissions</span><span class="o">=</span><span class="n">emissions</span><span class="p">,</span> 
</span><span id="line-2003">                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="line-2004">                <span class="n">y_label</span> <span class="o">=</span> <span class="n">y_label</span><span class="p">,</span>
</span><span id="line-2005">                <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="line-2006">        <span class="bp">self</span><span class="o">.</span><span class="n">plot_emission_bars</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">output_name</span><span class="p">)</span>
</span><span id="line-2007">        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="line-2008">        <span class="c1"># Clear unused axes if the number of gases is less than the number of axes</span>
</span><span id="line-2009">        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">emission_var</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="line-2010">            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</span><span id="line-2011">        <span class="bp">self</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;Emission Profiles and Totals&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">175</span><span class="p">)</span>
</span><span id="line-2012">        <span class="n">fig</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear all axes from the figure</span>
</span><span id="line-2013">        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

</span><span id="line-2014">        
</span><span id="line-2015">
<div class="viewcode-block" id="HTMLWriter.plot_emission_bars">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.plot_emission_bars">[docs]</a>
</span><span id="line-2016">    <span class="k">def</span><span class="w"> </span><span class="nf">plot_emission_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">output_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-2017"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot total emissions as a bar chart.&quot;&quot;&quot;</span>
</span><span id="line-2018">        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span>
</span><span id="line-2019">        <span class="n">vars_to_plot</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;co2_net&#39;</span><span class="p">,</span> <span class="s1">&#39;ch4_net&#39;</span><span class="p">,</span> <span class="s1">&#39;n2o_mean&#39;</span><span class="p">)</span>
</span><span id="line-2020">        <span class="n">bars</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">[</span><span class="s1">&#39;outputs&#39;</span><span class="p">][</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;gas_name_latex&#39;</span><span class="p">]</span> <span class="k">for</span>
</span><span id="line-2021">                <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_to_plot</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="line-2022">        <span class="c1"># Get reservoir area from inputs (convert from km2 to m2)</span>
</span><span id="line-2023">        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">output_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;reservoir&#39;</span><span class="p">][</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="line-2024">            <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
</span><span id="line-2025">        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_to_plot</span>
</span><span id="line-2026">                  <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="line-2027">        <span class="n">emission_bars</span><span class="p">(</span>
</span><span id="line-2028">            <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">gases</span><span class="o">=</span><span class="n">bars</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
</span><span id="line-2029">            <span class="n">output_name</span><span class="o">=</span><span class="n">output_name</span><span class="p">)</span></div>

</span><span id="line-2030">
<div class="viewcode-block" id="HTMLWriter.write">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.HTMLWriter.write">[docs]</a>
</span><span id="line-2031">    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-2032"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the HTML content to the output file.&quot;&quot;&quot;</span>
</span><span id="line-2033">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="line-2034">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Attempting to write before generating outputs.&quot;</span><span class="p">)</span>
</span><span id="line-2035">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-2036">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="line-2037">            <span class="s1">&#39;&lt;button class=&quot;toggle-theme&quot; onclick=&quot;toggleTheme()&quot;&gt;Toggle Dark Mode&lt;/button&gt;&#39;</span>
</span><span id="line-2038">        <span class="p">)</span>
</span><span id="line-2039">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;reservoir-links&quot;&gt;&#39;</span><span class="p">)</span>
</span><span id="line-2040">        <span class="k">for</span> <span class="n">_ix</span><span class="p">,</span> <span class="n">reservoir_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="line-2041">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="line-2042">                <span class="sa">f</span><span class="s1">&#39;&lt;a href=&quot;#res-</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s1">&quot; title=&quot;Jump to </span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s1">&quot;&gt;</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s1">&lt;/a&gt;&#39;</span>
</span><span id="line-2043">            <span class="p">)</span>
</span><span id="line-2044">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">)</span>  <span class="c1"># Close #reservoir-links container</span>
</span><span id="line-2045">        
</span><span id="line-2046">        <span class="k">for</span> <span class="n">_ix</span><span class="p">,</span> <span class="n">reservoir_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">):</span>
</span><span id="line-2047">            <span class="n">reservoir_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">reservoir_name</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="line-2048">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding data for reservoir: </span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s2">, Progress: </span><span class="si">{</span><span class="n">_ix</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="line-2049">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;section id=&quot;res-</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s1">&quot;&gt;&#39;</span><span class="p">)</span>
</span><span id="line-2050">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;details open&gt;&lt;summary&gt;</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s2">&lt;/summary&gt;&quot;</span><span class="p">)</span>
</span><span id="line-2051">            <span class="bp">self</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">reservoir_type</span><span class="si">}</span><span class="s2"> reservoir&quot;</span><span class="p">)</span>
</span><span id="line-2052">            <span class="bp">self</span><span class="o">.</span><span class="n">add_inputs_table</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-2053">            <span class="bp">self</span><span class="o">.</span><span class="n">add_landcover_piecharts</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-2054">            <span class="bp">self</span><span class="o">.</span><span class="n">add_outputs_table</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-2055">            <span class="bp">self</span><span class="o">.</span><span class="n">add_plots</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-2056">            <span class="bp">self</span><span class="o">.</span><span class="n">add_intern_vars_table</span><span class="p">(</span><span class="n">reservoir_name</span><span class="p">)</span>
</span><span id="line-2057">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;button class=&quot;export-btn&quot; onclick=&quot;exportSection(</span><span class="se">\&#39;</span><span class="s1">res-</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">reservoir_name</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">)&quot;&gt;Export&lt;/button&gt;&#39;</span><span class="p">)</span>
</span><span id="line-2058">            <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;/details&gt;&lt;/section&gt;&quot;</span><span class="p">)</span>
</span><span id="line-2059">        <span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">)</span>
</span><span id="line-2060">        <span class="c1"># Join all fragments into a single string</span>
</span><span id="line-2061">        <span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_fragments</span><span class="p">)</span>
</span><span id="line-2062">
</span><span id="line-2063">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="line-2064">            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</span><span id="line-2065">
</span><span id="line-2066">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created an HTML file at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_file_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>
</div>

</span><span id="line-2067">
</span><span id="line-2068">
<div class="viewcode-block" id="Presenter">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Presenter">[docs]</a>
</span><span id="line-2069"><span class="nd">@dataclass</span>
</span><span id="line-2070"><span class="k">class</span><span class="w"> </span><span class="nc">Presenter</span><span class="p">:</span>
</span><span id="line-2071"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads and processes results of GHG emission calculations and outputs</span>
</span><span id="line-2072"><span class="sd">    them in different formats.</span>
</span><span id="line-2073">
</span><span id="line-2074"><span class="sd">    Attributes:</span>
</span><span id="line-2075"><span class="sd">        inputs (Inputs): An instance of Inputs class containing input data.</span>
</span><span id="line-2076"><span class="sd">        outputs (Dict): Dictionary containing model outputs.</span>
</span><span id="line-2077"><span class="sd">        intern_vars (Dict): Dictionary of internal variables.</span>
</span><span id="line-2078"><span class="sd">        writers (Optional[List[Writer]]): Optional list of Writer objects for output.</span>
</span><span id="line-2079"><span class="sd">        author (str): Name of the author. Default is &#39;Anonymous&#39;.</span>
</span><span id="line-2080"><span class="sd">        title (str): Title of the document. Default is &#39;Results&#39;.</span>
</span><span id="line-2081"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-2082">
</span><span id="line-2083">    <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span>
</span><span id="line-2084">    <span class="n">outputs</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-2085">    <span class="n">intern_vars</span><span class="p">:</span> <span class="n">Dict</span>
</span><span id="line-2086">    <span class="n">writers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Writer</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="line-2087">    <span class="n">author</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">)</span>
</span><span id="line-2088">    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Results&#39;</span><span class="p">)</span>
</span><span id="line-2089">
<div class="viewcode-block" id="Presenter.fromfiles">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Presenter.fromfiles">[docs]</a>
</span><span id="line-2090">    <span class="nd">@classmethod</span>
</span><span id="line-2091">    <span class="k">def</span><span class="w"> </span><span class="nf">fromfiles</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interns_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="line-2092"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an instance of Presenter from JSON files.</span>
</span><span id="line-2093">
</span><span id="line-2094"><span class="sd">        Args:</span>
</span><span id="line-2095"><span class="sd">            input_file (str): Path to JSON file containing input data.</span>
</span><span id="line-2096"><span class="sd">            output_file (str): Path to JSON file containing model outputs.</span>
</span><span id="line-2097"><span class="sd">            interns_file (str): Path to JSON file containioutput_file_pathng internal variables.</span>
</span><span id="line-2098"><span class="sd">            **kwargs: Additional keyword arguments for customization.</span>
</span><span id="line-2099">
</span><span id="line-2100"><span class="sd">        Returns:</span>
</span><span id="line-2101"><span class="sd">            Presenter: An instance of Presenter initialized with data loaded from files.</span>
</span><span id="line-2102"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-2103">        <span class="n">inputs</span> <span class="o">=</span> <span class="n">Inputs</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
</span><span id="line-2104">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="line-2105">            <span class="n">output_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="line-2106">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">interns_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="line-2107">            <span class="n">intern_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="line-2108">        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="line-2109">            <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_dict</span><span class="p">,</span> <span class="n">intern_vars</span><span class="o">=</span><span class="n">intern_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

</span><span id="line-2110">
<div class="viewcode-block" id="Presenter.__post_init__">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Presenter.__post_init__">[docs]</a>
</span><span id="line-2111">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="line-2112"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads configuration files after instance initialization.&quot;&quot;&quot;</span>
</span><span id="line-2113">        <span class="bp">self</span><span class="o">.</span><span class="n">input_config</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_inputs&quot;</span><span class="p">)</span>
</span><span id="line-2114">        <span class="bp">self</span><span class="o">.</span><span class="n">output_config</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_outputs&quot;</span><span class="p">)</span>
</span><span id="line-2115">        <span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_internal&quot;</span><span class="p">)</span>
</span><span id="line-2116">        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_config</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;report_parameters&quot;</span><span class="p">)</span>
</span><span id="line-2117">        <span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_config&quot;</span><span class="p">)</span></div>

</span><span id="line-2118">
<div class="viewcode-block" id="Presenter.add_writer">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Presenter.add_writer">[docs]</a>
</span><span id="line-2119">    <span class="k">def</span><span class="w"> </span><span class="nf">add_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writer</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Writer</span><span class="p">],</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-2120"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a Writer object to the list of writers.</span>
</span><span id="line-2121">
</span><span id="line-2122"><span class="sd">        Args:</span>
</span><span id="line-2123"><span class="sd">            writer (Type[Writer]): Type of Writer to instantiate.</span>
</span><span id="line-2124"><span class="sd">            output_file (str): Path to the output file for the Writer.</span>
</span><span id="line-2125">
</span><span id="line-2126"><span class="sd">        Returns:</span>
</span><span id="line-2127"><span class="sd">            None</span>
</span><span id="line-2128"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="line-2129">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-2130">            <span class="bp">self</span><span class="o">.</span><span class="n">writers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-2131">        <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="line-2132">            <span class="n">writer</span><span class="p">(</span>
</span><span id="line-2133">                <span class="n">output_file_path</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
</span><span id="line-2134">                <span class="n">outputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span>
</span><span id="line-2135">                <span class="n">intern_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intern_vars</span><span class="p">,</span>
</span><span id="line-2136">                <span class="n">output_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">output_config</span><span class="p">,</span>
</span><span id="line-2137">                <span class="n">input_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_config</span><span class="p">,</span>
</span><span id="line-2138">                <span class="n">intern_vars_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intern_vars_config</span><span class="p">,</span>
</span><span id="line-2139">                <span class="n">parameter_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_config</span><span class="p">,</span>
</span><span id="line-2140">                <span class="n">config_ini</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_ini</span><span class="p">,</span>
</span><span id="line-2141">                <span class="n">inputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span>
</span><span id="line-2142">                <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span><span class="p">,</span>
</span><span id="line-2143">                <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span><span id="line-2144">            <span class="p">)</span>
</span><span id="line-2145">        <span class="p">)</span></div>

</span><span id="line-2146">
<div class="viewcode-block" id="Presenter.output">
<a class="viewcode-back" href="../../api/reemission.presenter.html#reemission.presenter.Presenter.output">[docs]</a>
</span><span id="line-2147">    <span class="k">def</span><span class="w"> </span><span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-2148"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Outputs GHG emission calculation results using writers.&quot;&quot;&quot;</span>
</span><span id="line-2149">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-2150">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No writers specified. Results could not be output.&quot;</span><span class="p">)</span>
</span><span id="line-2151">            <span class="k">return</span> <span class="kc">None</span>
</span><span id="line-2152">        <span class="k">for</span> <span class="n">writer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">writers</span><span class="p">:</span>
</span><span id="line-2153">            <span class="n">writer</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</span><span id="line-2154">        <span class="k">return</span> <span class="kc">None</span></div>
</div>

</span><span id="line-2155">
</span><span id="line-2156">
</span><span id="line-2157"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="line-2158">    <span class="k">pass</span>
</span></code></pre></div>
    </div><div class="flex justify-between items-center pt-6 mt-12 border-t border-border gap-4">
</div></div>
        </main>
      </div>
    </div><footer class="py-6 border-t border-border md:py-0">
    <div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
      <div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
        <p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2024, Tomasz Janus, University of Manchester, United Kingdom&nbsp;Built with <a class="font-medium underline underline-offset-4"
    href="https://www.sphinx-doc.org"
    rel="noreferrer">Sphinx 8.1.3</a></p>
</div>
</div>
</footer>
  </div>
  
    <script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/toggleprompt.js?v=5801b3bb"></script>
    <script defer="defer" src="../../_static/theme.js?v=073f68d9"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
  
</body>
</html>